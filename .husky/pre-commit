#!/bin/sh

echo ""
echo "============================================================"
echo "   TENANT SHIELD - PRE-COMMIT CHECK"
echo "============================================================"
echo ""

# Run syntax check first (fast)
cd backend && npm run lint:syntax
if [ $? -ne 0 ]; then
  echo ""
  echo "============================================================"
  echo "  COMMIT BLOQUE - ERREUR DE SYNTAXE DETECTEE"
  echo "  Corrige les erreurs ci-dessus puis relance git commit"
  echo "============================================================"
  echo ""
  exit 1
fi

# Run tenant isolation lint
npm run lint:tenant
if [ $? -ne 0 ]; then
  echo ""
  echo "============================================================"
  echo "  COMMIT BLOQUE - VIOLATION TENANT SHIELD DETECTEE"
  echo ""
  echo "  Lis: TENANT_SHIELD.md"
  echo "  Fix: Ajoute .eq('tenant_id', tenantId) a tes requetes"
  echo "  Apres correction, relance: git commit"
  echo "============================================================"
  echo ""
  exit 1
fi

echo ""
echo "TENANT SHIELD: Code valide - Commit autorise"
echo ""
