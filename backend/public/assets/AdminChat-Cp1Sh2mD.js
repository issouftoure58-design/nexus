import{c as Y,b as Z,r as i,O as g,j as e,Q as M,L as J,S as ee}from"./index-_yXYEqcL.js";import{S as te}from"./sparkles-BX8nnFHk.js";import{P as se}from"./panel-left-close-C4ECLCua.js";import{P as ne}from"./plus-D6ktc07k.js";import{M as re}from"./message-square-BHRNNhOm.js";import{T as ae}from"./trash-2-CXbRkBbN.js";import{A as ie}from"./arrow-left-BsOgyces.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=Y("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]);function me(){const[,U]=Z(),[y,E]=i.useState([]),[x,A]=i.useState(null),[p,o]=i.useState([]),[N,I]=i.useState(""),[u,T]=i.useState(!1),[C,b]=i.useState(!0),[S,q]=i.useState(!1),P=i.useRef(null),z=i.useRef(null),v=()=>localStorage.getItem("admin_token");i.useEffect(()=>{const t=()=>{const s=window.innerWidth<768;q(s),s&&b(!1)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),i.useEffect(()=>{K()},[]),i.useEffect(()=>{P.current?.scrollIntoView({behavior:"smooth"})},[p]),i.useEffect(()=>{z.current&&(z.current.style.height="auto",z.current.style.height=Math.min(z.current.scrollHeight,200)+"px")},[N]);const K=async()=>{try{const t=await fetch(`${g}/api/admin/chat/conversations`,{headers:{Authorization:`Bearer ${v()}`}});if(t.ok){const s=await t.json();E(s.conversations||[])}}catch(t){console.error("Error loading conversations:",t)}},_=async t=>{try{const s=await fetch(`${g}/api/admin/chat/conversations/${t}/messages`,{headers:{Authorization:`Bearer ${v()}`}});if(s.ok){const n=await s.json();o(n.messages||[])}}catch(s){console.error("Error loading messages:",s)}},O=async t=>{try{const s=await fetch(`${g}/api/admin/chat/conversations`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v()}`},body:JSON.stringify({title:t||"Nouvelle conversation"})});if(s.ok){const n=await s.json();return E(k=>[n.conversation,...k]),A(n.conversation.id),o([]),S&&b(!1),n.conversation.id}return null}catch(s){return console.error("Error creating conversation:",s),null}},H=async(t,s)=>{if(s.stopPropagation(),!!confirm("Supprimer cette conversation ?"))try{await fetch(`${g}/api/admin/chat/conversations/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${v()}`}}),E(n=>n.filter(k=>k.id!==t)),x===t&&(A(null),o([]))}catch(n){console.error("Error deleting conversation:",n)}},Q=t=>{A(t.id),_(t.id),S&&b(!1)},$=i.useCallback(async t=>{const s=t||N.trim();if(!s||u)return;t||I(""),T(!0);let n=x;if(!n&&(n=await O(s.substring(0,50)),!n)){T(!1);return}const k=`user-${Date.now()}`;o(c=>[...c,{id:k,role:"user",content:s}]);const h=`assistant-${Date.now()}`;o(c=>[...c,{id:h,role:"assistant",content:"",streaming:!0}]);try{const c=`${g}/api/admin/chat/conversations/${n}/messages/stream`,l=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v()}`},body:JSON.stringify({content:s})});if(!l.ok)throw new Error(`HTTP ${l.status}`);if((l.headers.get("content-type")||"").includes("text/event-stream")){const r=l.body?.getReader(),a=new TextDecoder;let m="";if(r)for(;;){const{done:F,value:G}=await r.read();if(F)break;m+=a.decode(G,{stream:!0});const R=m.split(`
`);m=R.pop()||"";for(const B of R)if(B.startsWith("data: ")){const D=B.slice(6).trim();if(D==="[DONE]")continue;try{const j=JSON.parse(D);if(j.type==="text"&&j.content&&o(L=>L.map(d=>d.id===h?{...d,content:d.content+j.content}:d)),j.type==="done"&&o(L=>L.map(d=>d.id===h?{...d,streaming:!1}:d)),j.type==="error")throw new Error(j.message||"Erreur serveur")}catch{}}}}else{const r=await l.json();if(r.success&&r.response)o(a=>a.map(m=>m.id===h?{...m,content:r.response,streaming:!1}:m));else throw new Error(r.error||"Erreur inconnue")}o(r=>r.map(a=>a.id===h?{...a,streaming:!1}:a));const w=y.find(r=>r.id===n);w&&w.title==="Nouvelle conversation"&&E(r=>r.map(a=>a.id===n?{...a,title:s.substring(0,50)}:a))}catch(c){console.error("[AdminChat] Erreur:",c);try{const l=`${g}/api/admin/chat/conversations/${n}/messages`,f=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v()}`},body:JSON.stringify({content:s})});if(f.ok){const w=await f.json();if(w.success&&w.response){o(r=>r.map(a=>a.id===h?{...a,content:w.response,streaming:!1}:a));return}}}catch{}o(l=>l.map(f=>f.id===h?{...f,content:`Erreur: ${c.message}. Veuillez réessayer.`,streaming:!1}:f))}finally{T(!1)}},[N,u,x,y]),V=i.useCallback(t=>{$(t)},[$]),W=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),$())},X=()=>{U("/admin/dashboard")};return e.jsxs("div",{className:"fixed inset-0 flex bg-zinc-950",children:[S&&C&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-30",onClick:()=>b(!1)}),e.jsxs("aside",{className:`
        ${S?`fixed inset-y-0 left-0 z-40 w-72 transform transition-transform duration-300 ease-in-out ${C?"translate-x-0":"-translate-x-full"}`:`relative transition-all duration-300 ease-in-out ${C?"w-72":"w-0"}`}
        bg-zinc-900 border-r border-zinc-800 flex flex-col flex-shrink-0 overflow-hidden
      `,children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-zinc-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-cyan-400 to-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(te,{size:16,className:"text-white"})}),e.jsx("span",{className:"font-semibold text-white",children:"NEXUS AI"})]}),e.jsx("button",{onClick:()=>b(!1),className:"p-1.5 hover:bg-zinc-800 rounded-lg text-zinc-400 hover:text-white",children:e.jsx(se,{size:18})})]}),e.jsx("div",{className:"p-3",children:e.jsxs("button",{onClick:()=>O(),className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-400 hover:to-blue-500 text-white rounded-xl font-medium transition-all shadow-lg shadow-cyan-500/20 text-sm",children:[e.jsx(ne,{size:18}),"Nouvelle conversation"]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-2 space-y-1",children:[y.map(t=>e.jsxs("div",{onClick:()=>Q(t),className:`
                group flex items-center gap-3 px-3 py-2.5 rounded-xl cursor-pointer transition-all
                ${x===t.id?"bg-zinc-800 text-white":"text-zinc-400 hover:bg-zinc-800/50 hover:text-white"}
              `,children:[e.jsx(re,{size:16,className:"flex-shrink-0"}),e.jsx("span",{className:"flex-1 truncate text-sm",children:t.title}),e.jsx("button",{onClick:s=>H(t.id,s),className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-red-500/20 hover:text-red-400 rounded transition-all",children:e.jsx(ae,{size:14})})]},t.id)),y.length===0&&e.jsx("div",{className:"text-center text-zinc-500 py-8 text-sm",children:"Aucune conversation"})]}),e.jsx("div",{className:"p-3 border-t border-zinc-800 text-xs text-zinc-500",children:"Claude Sonnet 4"})]}),e.jsxs("main",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("header",{className:"h-14 border-b border-zinc-800 flex items-center px-4 gap-3 flex-shrink-0 bg-zinc-900/50",children:[!C&&e.jsx("button",{onClick:()=>b(!0),className:"p-2 hover:bg-zinc-800 rounded-lg text-zinc-400 hover:text-white transition-colors",title:"Afficher la sidebar",children:e.jsx(oe,{size:20})}),e.jsx("button",{onClick:X,className:"p-2 hover:bg-zinc-800 rounded-lg text-zinc-400 hover:text-white transition-colors",title:"Retour au dashboard",children:e.jsx(ie,{size:20})}),e.jsx("h1",{className:"text-white font-medium truncate flex-1",children:x?y.find(t=>t.id===x)?.title||"Chat":"Nouveau chat"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:p.length===0&&!x?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center px-4 py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-cyan-400 to-blue-600 rounded-2xl flex items-center justify-center mb-6 shadow-lg shadow-cyan-500/20",children:e.jsx(M,{size:32,className:"text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"NEXUS AI Assistant"}),e.jsx("p",{className:"text-zinc-400 max-w-md mb-8",children:"Je suis votre assistant IA. Posez-moi des questions sur votre activité, vos rendez-vous, vos clients, ou demandez-moi de l'aide."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 max-w-2xl w-full",children:["Montre-moi les rendez-vous d'aujourd'hui","Quels sont mes meilleurs clients ?","Analyse mes revenus du mois","Aide-moi à rédiger un message"].map((t,s)=>e.jsx("button",{onClick:()=>V(t),disabled:u,className:"px-4 py-3 bg-zinc-800/50 hover:bg-zinc-800 border border-zinc-700 hover:border-cyan-500/50 rounded-xl text-left text-sm text-zinc-300 hover:text-white transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:t},s))})]}):e.jsx("div",{className:"w-full flex flex-col items-center",children:e.jsxs("div",{className:"w-full max-w-3xl px-4 md:px-6 py-6 space-y-4",children:[p.map(t=>e.jsxs("div",{className:`flex ${t.role==="user"?"justify-end":"justify-start"}`,children:[t.role==="assistant"&&e.jsxs("div",{className:"flex gap-3 max-w-[85%]",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-blue-600 flex items-center justify-center flex-shrink-0",children:e.jsx(M,{size:16,className:"text-white"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"bg-zinc-800 rounded-2xl rounded-tl-sm px-4 py-3 text-white whitespace-pre-wrap break-words leading-relaxed",children:[t.content||(t.streaming?"":"..."),t.streaming&&e.jsx("span",{className:"inline-block w-2 h-4 bg-cyan-400 ml-1 animate-pulse"})]})})]}),t.role==="user"&&e.jsx("div",{className:"max-w-[85%]",children:e.jsx("div",{className:"bg-gradient-to-r from-cyan-500 to-blue-600 rounded-2xl rounded-tr-sm px-4 py-3 text-white whitespace-pre-wrap break-words leading-relaxed",children:t.content})})]},t.id)),u&&p.length>0&&p[p.length-1]?.role==="user"&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-blue-600 flex items-center justify-center flex-shrink-0",children:e.jsx(M,{size:16,className:"text-white"})}),e.jsxs("div",{className:"bg-zinc-800 rounded-2xl rounded-tl-sm px-4 py-3 flex items-center gap-2 text-zinc-400",children:[e.jsx(J,{size:16,className:"animate-spin"}),e.jsx("span",{className:"text-sm",children:"Réflexion en cours..."})]})]})}),e.jsx("div",{ref:P})]})})}),e.jsx("div",{className:"border-t border-zinc-800 p-4 flex-shrink-0",children:e.jsx("div",{className:"w-full flex justify-center",children:e.jsxs("div",{className:"w-full max-w-4xl",children:[e.jsxs("div",{className:"relative bg-zinc-800 rounded-2xl border border-zinc-700 focus-within:border-cyan-500/50 transition-colors",children:[e.jsx("textarea",{ref:z,value:N,onChange:t=>I(t.target.value),onKeyDown:W,placeholder:"Écrivez votre message...",rows:1,className:"w-full bg-transparent text-white placeholder-zinc-500 px-4 py-3 pr-14 resize-none focus:outline-none max-h-[200px]",disabled:u}),e.jsx("button",{onClick:()=>$(),disabled:!N.trim()||u,className:"absolute right-2 bottom-2 w-10 h-10 bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-400 hover:to-blue-500 disabled:from-zinc-600 disabled:to-zinc-600 disabled:cursor-not-allowed text-white rounded-xl flex items-center justify-center transition-all",children:u?e.jsx(J,{size:18,className:"animate-spin"}):e.jsx(ee,{size:18})})]}),e.jsx("p",{className:"text-xs text-zinc-500 text-center mt-2",children:"Entrée pour envoyer · Maj+Entrée pour saut de ligne"})]})})})]})]})}export{me as default};
