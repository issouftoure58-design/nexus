import{c as g,r as t,j as e,M as H,X as U,L as V,w as ae,v as ne,S as re,U as ie,B as _,t as le,d as z,b as oe,Q as ce,V as q}from"./index-_yXYEqcL.js";import{F as G}from"./file-text-DGGLtmm2.js";import{I as W}from"./image-nfPd-l1I.js";import{a as J,S as de,L as he,C as me}from"./settings-BkyowQvs.js";import{U as ue}from"./user-Ai5-1aUm.js";import{C as K}from"./calendar-NWhThMGY.js";import{S as X}from"./scissors-DPHsfmq1.js";import{U as pe}from"./users-DLPfMp13.js";import{S as xe}from"./shopping-bag-CEo4UOGG.js";import{M as fe}from"./message-square-BHRNNhOm.js";import{S as ge}from"./sparkles-BX8nnFHk.js";import{C as be}from"./chart-column-eauyrf0D.js";import{C as we}from"./chevron-right-DPdOXaL5.js";import{L as ye}from"./log-out-CvuSphzZ.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=g("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=g("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=g("CalendarRange",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M17 14h-6",key:"bkmgh3"}],["path",{d:"M13 18H7",key:"bb0bb7"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 18h.01",key:"1bdyru"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=g("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=g("Megaphone",[["path",{d:"m3 11 18-5v12L3 14v-3z",key:"n962bs"}],["path",{d:"M11.6 16.8a3 3 0 1 1-5.8-1.6",key:"1yl0tm"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=g("MessagesSquare",[["path",{d:"M14 9a2 2 0 0 1-2 2H6l-4 4V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2z",key:"p1xzt8"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1",key:"1cx29u"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=g("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=g("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=g("ScrollText",[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=g("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=g("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=g("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=g("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=g("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=g("UsersRound",[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=g("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);function Te(){const[f,p]=t.useState(!1),[l,o]=t.useState("Halimah Pro"),[c,y]=t.useState([{id:"1",role:"assistant",content:"Salut ! Je suis ton assistant IA. Comment puis-je t'aider ?"}]);t.useEffect(()=>{fetch("/api/admin/agents",{headers:{Authorization:`Bearer ${localStorage.getItem("admin_token")}`}}).then(s=>s.json()).then(s=>{const r=s.agents?.find(i=>i.agent_type==="backoffice");r?.custom_name&&(o(r.custom_name),y([{id:"1",role:"assistant",content:`Salut ! Je suis ${r.custom_name}, ton assistant IA. Comment puis-je t'aider ?`}]))}).catch(()=>{})},[]);const[N,v]=t.useState(""),[u,j]=t.useState(!1),[b,C]=t.useState(!1),[n,I]=t.useState(!1),[w,E]=t.useState(!1),[T,R]=t.useState(""),[M,$]=t.useState([]),[a,d]=t.useState(!1),k=t.useRef(null),S=t.useRef(null),F=t.useRef(null),B=s=>s.replace(/[\u{1F600}-\u{1F64F}]/gu,"").replace(/[\u{1F300}-\u{1F5FF}]/gu,"").replace(/[\u{1F680}-\u{1F6FF}]/gu,"").replace(/[\u{1F700}-\u{1F77F}]/gu,"").replace(/[\u{1F780}-\u{1F7FF}]/gu,"").replace(/[\u{1F800}-\u{1F8FF}]/gu,"").replace(/[\u{1F900}-\u{1F9FF}]/gu,"").replace(/[\u{1FA00}-\u{1FA6F}]/gu,"").replace(/[\u{1FA70}-\u{1FAFF}]/gu,"").replace(/[\u{2600}-\u{26FF}]/gu,"").replace(/[\u{2700}-\u{27BF}]/gu,"").replace(/[\u{FE00}-\u{FE0F}]/gu,"").replace(/[\u{1F1E0}-\u{1F1FF}]/gu,"").replace(/\*\*([^*]+)\*\*/g,"... $1 ...").replace(/ðŸ“…/g,"... ").replace(/(\d{1,2})\s+(janvier|fÃ©vrier|mars|avril|mai|juin|juillet|aoÃ»t|septembre|octobre|novembre|dÃ©cembre)\s+(\d{4})/gi,(r,i,h,x)=>`${i}, ${h}, ${x}`).replace(/(\d{1,2})h00\b/gi,"$1 heures").replace(/(\d+)h(\d+)/gi,"$1 heures $2").replace(/Tel\s*:\s*(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,"TÃ©lÃ©phone... $1, $2, $3, $4, $5").replace(/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/g,"$1, $2, $3, $4, $5").replace(/(\w)\/(\w)/g,"$1 ou $2").replace(/^[-â€¢]\s*/gm,"... ").replace(/\n[-â€¢]\s*/g,"... ").replace(/:\s*/g,"... ").replace(/;\s*/g,". ").replace(/[Â«Â»""'']/g,"").replace(/\(/g,", ").replace(/\)/g,", ").replace(/â‚¬/g," euros ").replace(/&/g," et ").replace(/%/g," pourcent ").replace(/\+/g," plus ").replace(/@/g," arobase ").replace(/âŒ/g,"").replace(/â³/g,"").replace(/âœ…/g,"").replace(/AnnulÃ©/gi,"... annulÃ©").replace(/En attente de confirmation/gi,"... en attente de confirmation").replace(/ConfirmÃ©/gi,"... confirmÃ©").replace(/-{2,}/g,"... ").replace(/\.{4,}/g,"... ").replace(/\n+/g,"... ").replace(/[*#_~`]/g,"").replace(/,{2,}/g,",").replace(/\s{2,}/g," ").replace(/\s+\./g,".").replace(/\s+,/g,",").replace(/\.+\s*\.+/g,"... ").trim(),L=t.useRef(null);t.useCallback(async s=>{if(!n||typeof window>"u"||!s)return;L.current&&(L.current.pause(),L.current=null);const r=B(s);if(r){C(!0),console.log("[ELEVENLABS] GÃ©nÃ©ration audio pour:",r.substring(0,50)+"...");try{const i=await fetch("/api/tts/elevenlabs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:r})});if(!i.ok)throw new Error(`TTS error: ${i.status}`);const h=await i.blob(),x=URL.createObjectURL(h),m=new Audio(x);L.current=m,m.onended=()=>{C(!1),URL.revokeObjectURL(x)},m.onerror=()=>{console.error("[ELEVENLABS] Erreur lecture audio"),C(!1),URL.revokeObjectURL(x)},await m.play(),console.log("[ELEVENLABS] âœ… Audio en lecture")}catch(i){console.error("[ELEVENLABS] Erreur:",i),C(!1)}}},[n]);const D=t.useCallback(()=>{if(typeof window>"u")return null;const s=window.SpeechRecognition||window.webkitSpeechRecognition;if(!s)return console.warn("[HALIMAH PRO] Reconnaissance vocale non supportÃ©e"),null;const r=new s;return r.continuous=!1,r.interimResults=!0,r.lang="fr-FR",r.onstart=()=>{E(!0),R("")},r.onresult=i=>{let h="",x="";for(let m=i.resultIndex;m<i.results.length;m++){const A=i.results[m][0].transcript;i.results[m].isFinal?h+=A:x+=A}h?(v(m=>m+h),R("")):R(x)},r.onerror=i=>{console.error("[HALIMAH PRO] Erreur reconnaissance vocale:",i),E(!1),R("")},r.onend=()=>{E(!1),R("")},r},[]),Q=t.useCallback(()=>{if(w)S.current?.stop(),E(!1);else if(S.current||(S.current=D()),S.current)try{S.current.start()}catch{console.warn("[HALIMAH PRO] Recognition already started")}},[w,D]),Y=s=>{const r=s.target.files;if(!r)return;const i=[],h=10*1024*1024,x=["image/jpeg","image/png","image/gif","image/webp","application/pdf","text/plain","text/csv"];for(let m=0;m<r.length;m++){const A=r[m];if(A.size>h){alert(`${A.name} est trop volumineux (max 10MB)`);continue}if(!x.includes(A.type)){alert(`${A.name}: type de fichier non supportÃ©`);continue}i.push(A)}$(m=>[...m,...i].slice(0,5)),F.current&&(F.current.value="")},Z=s=>{$(r=>r.filter((i,h)=>h!==s))},ee=async s=>{const r=[],i=localStorage.getItem("admin_token");for(const h of s){const x=new FormData;x.append("file",h);try{const m=await fetch("/api/admin/halimah-pro/upload",{method:"POST",headers:{Authorization:`Bearer ${i}`},body:x});if(m.ok){const A=await m.json();r.push({type:h.type.startsWith("image/")?"image":"document",name:h.name,url:A.url,mimeType:h.type})}}catch(m){console.error("[UPLOAD] Erreur:",m)}}return r},O=async()=>{if(!N.trim()&&M.length===0||u)return;w&&(S.current?.stop(),E(!1));let s=[];M.length>0&&(d(!0),s=await ee(M),d(!1));const r={id:Date.now().toString(),role:"user",content:N.trim()||(s.length>0?`[${s.length} fichier(s) joint(s)]`:""),attachments:s.length>0?s:void 0};y(i=>[...i,r]),v(""),$([]),R(""),j(!0);try{const i=localStorage.getItem("admin_token"),h=await fetch("/api/admin/halimah-pro/chat",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({message:r.content,attachments:s,conversationHistory:c.slice(-10).map(P=>({role:P.role,content:P.content}))})}),x=await h.json();if(!h.ok)throw console.error("[HALIMAH PRO] Erreur:",h.status,x),new Error(x.message||x.error||`Erreur ${h.status}`);const m=x.response||"DÃ©solÃ©e, je n'ai pas compris. Peux-tu reformuler ?",A={id:(Date.now()+1).toString(),role:"assistant",content:m};y(P=>[...P,A])}catch(i){console.error("[HALIMAH PRO] Erreur:",i);let h="DÃ©solÃ©e, je rencontre un problÃ¨me technique. RÃ©essaie dans un moment.";i?.message?.includes("fetch")||i?.message?.includes("network")?h="Je n'arrive pas Ã  joindre le serveur. VÃ©rifie ta connexion.":i?.message?.includes("401")&&(h="Ta session a expirÃ©. Reconnecte-toi."),y(x=>[...x,{id:(Date.now()+1).toString(),role:"assistant",content:h}])}finally{j(!1)}},te=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),O())};t.useEffect(()=>{typeof window<"u"&&window.speechSynthesis&&(window.speechSynthesis.getVoices(),window.speechSynthesis.onvoiceschanged=()=>{window.speechSynthesis.getVoices()})},[]),t.useEffect(()=>()=>{S.current?.abort(),window.speechSynthesis?.cancel()},[]),t.useEffect(()=>{k.current?.scrollIntoView({behavior:"smooth"})},[c]);const se=typeof window<"u"&&(window.SpeechRecognition||window.webkitSpeechRecognition);return e.jsxs(e.Fragment,{children:[!f&&e.jsx("button",{onClick:()=>p(!0),className:`fixed bottom-4 right-4 md:bottom-6 md:right-6 z-50 w-12 h-12 md:w-14 md:h-14 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full shadow-lg flex items-center justify-center hover:scale-110 transition-transform ${b?"animate-pulse":""}`,style:{zIndex:9999},title:`Parler Ã  ${l}`,children:e.jsx(H,{className:"w-6 h-6 md:w-7 md:h-7 text-white"})}),f&&e.jsxs("div",{className:"fixed bottom-0 right-0 md:bottom-6 md:right-6 z-50 w-full md:w-96 h-[85vh] md:h-[500px] bg-white md:rounded-2xl shadow-2xl flex flex-col overflow-hidden border-t md:border border-gray-200",style:{zIndex:9999},children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 bg-white/20 rounded-full flex items-center justify-center ${b?"animate-pulse":""}`,children:e.jsx(H,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold",children:l}),e.jsx("p",{className:"text-white/80 text-xs",children:w?"ðŸŽ¤ Je t'Ã©coute...":b?"ðŸ”Š Je parle...":"Assistante IA"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>p(!1),className:"text-white/80 hover:text-white",children:e.jsx(U,{className:"w-5 h-5"})})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50",children:[c.map(s=>e.jsx("div",{className:`flex ${s.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] px-4 py-2 rounded-2xl ${s.role==="user"?"bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-br-md":"bg-white text-gray-800 shadow-md rounded-bl-md"}`,children:[s.attachments&&s.attachments.length>0&&e.jsx("div",{className:"mb-2 space-y-1",children:s.attachments.map((r,i)=>e.jsx("div",{className:"flex items-center gap-2",children:r.type==="image"?e.jsx("img",{src:r.url,alt:r.name,className:"max-w-[200px] max-h-[150px] rounded-lg object-cover"}):e.jsxs("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",className:`flex items-center gap-1 px-2 py-1 rounded text-xs ${s.role==="user"?"bg-white/20 text-white":"bg-gray-100 text-gray-700"}`,children:[e.jsx(G,{className:"w-3 h-3"}),r.name]})},i))}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.content})]})},s.id)),u&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-white px-4 py-2 rounded-2xl shadow-md rounded-bl-md",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(V,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Halimah rÃ©flÃ©chit..."})]})})}),e.jsx("div",{ref:k})]}),e.jsxs("div",{className:"p-3 border-t bg-white",children:[M.length>0&&e.jsx("div",{className:"mb-2 flex flex-wrap gap-2",children:M.map((s,r)=>e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-purple-50 rounded-lg text-xs text-purple-700",children:[s.type.startsWith("image/")?e.jsx(W,{className:"w-3 h-3"}):e.jsx(G,{className:"w-3 h-3"}),e.jsx("span",{className:"max-w-[100px] truncate",children:s.name}),e.jsx("button",{onClick:()=>Z(r),className:"ml-1 text-purple-400 hover:text-purple-600",children:e.jsx(U,{className:"w-3 h-3"})})]},r))}),T&&e.jsxs("div",{className:"mb-2 px-3 py-1 bg-purple-50 rounded-lg text-sm text-purple-600 italic",children:[T,"..."]}),a&&e.jsxs("div",{className:"mb-2 px-3 py-1 bg-blue-50 rounded-lg text-sm text-blue-600 flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4 animate-spin"}),"Upload des fichiers..."]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{ref:F,type:"file",multiple:!0,accept:"image/*,.pdf,.txt,.csv",onChange:Y,className:"hidden"}),e.jsx("button",{onClick:()=>F.current?.click(),disabled:u||M.length>=5,className:"w-10 h-10 rounded-full flex items-center justify-center bg-gray-100 text-gray-600 hover:bg-purple-100 hover:text-purple-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed",title:"Joindre un fichier (max 5)",children:e.jsx(Me,{className:"w-5 h-5"})}),se&&e.jsx("button",{onClick:Q,disabled:u,className:`w-10 h-10 rounded-full flex items-center justify-center transition-all ${w?"bg-red-500 text-white animate-pulse":"bg-gray-100 text-gray-600 hover:bg-purple-100 hover:text-purple-600"} disabled:opacity-50 disabled:cursor-not-allowed`,title:w?"ArrÃªter l'Ã©coute":"Parler",children:w?e.jsx(ae,{className:"w-5 h-5"}):e.jsx(ne,{className:"w-5 h-5"})}),e.jsx("input",{type:"text",value:N,onChange:s=>v(s.target.value),onKeyPress:te,placeholder:w?"Parle maintenant...":"Ã‰cris ton message...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:border-purple-500 transition-colors",disabled:u}),e.jsx("button",{onClick:O,disabled:!N.trim()&&M.length===0||u,className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-full flex items-center justify-center hover:shadow-lg hover:shadow-purple-500/30 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(re,{className:"w-5 h-5"})})]})]})]})]})}function Pe(){const[f,p]=t.useState(null),[l,o]=t.useState(!1),[c,y]=t.useState(!1);t.useEffect(()=>{if(window.matchMedia("(display-mode: standalone)").matches){y(!0);return}const u=document.querySelector('link[rel="manifest"]');u&&u.setAttribute("href","/manifest-admin.webmanifest");const j=b=>{b.preventDefault(),p(b),localStorage.getItem("admin-pwa-dismissed")||o(!0)};return window.addEventListener("beforeinstallprompt",j),window.addEventListener("appinstalled",()=>{y(!0),o(!1),p(null)}),()=>{window.removeEventListener("beforeinstallprompt",j)}},[]);const N=async()=>{if(!f)return;await f.prompt();const{outcome:u}=await f.userChoice;u==="accepted"&&(o(!1),p(null))},v=()=>{o(!1),localStorage.setItem("admin-pwa-dismissed","true")};return c||!l?null:e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-8 md:w-96 z-50",children:e.jsx("div",{className:"bg-gradient-to-r from-amber-500 to-orange-600 rounded-2xl p-4 shadow-2xl shadow-amber-500/30",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-xl",children:e.jsx(ie,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-white mb-1",children:"Installer l'app Admin"}),e.jsx("p",{className:"text-white/80 text-sm mb-3",children:"AccÃ©dez rapidement au dashboard depuis votre Ã©cran d'accueil"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(_,{onClick:N,className:"bg-white text-amber-600 hover:bg-white/90 text-sm",size:"sm",children:[e.jsx(le,{className:"w-4 h-4 mr-1"}),"Installer"]}),e.jsx(_,{onClick:v,variant:"ghost",className:"text-white/70 hover:text-white hover:bg-white/10 text-sm",size:"sm",children:"Plus tard"})]})]}),e.jsx("button",{onClick:v,className:"text-white/50 hover:text-white transition-colors",children:e.jsx(U,{className:"w-5 h-5"})})]})})})}function Be({open:f,onClose:p}){const[l,o]=t.useState(""),[c,y]=t.useState(null),[N,v]=t.useState(!1),u=t.useRef(null),j=t.useRef();if(t.useEffect(()=>{f&&(setTimeout(()=>u.current?.focus(),100),o(""),y(null))},[f]),t.useEffect(()=>{if(!l.trim()||l.trim().length<2){y(null);return}return j.current&&clearTimeout(j.current),j.current=setTimeout(async()=>{v(!0);try{const n=localStorage.getItem("admin_token"),w=await(await fetch(`/api/admin/search?q=${encodeURIComponent(l)}`,{headers:{Authorization:`Bearer ${n}`}})).json();w.success&&y(w.results)}catch{}v(!1)},300),()=>{j.current&&clearTimeout(j.current)}},[l]),t.useEffect(()=>{const n=I=>{I.key==="Escape"&&f&&p()};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[f,p]),!f)return null;const b=c&&(c.clients.length>0||c.reservations.length>0||c.services.length>0),C=n=>{const[I,w,E]=n.split("-").map(Number);return new Date(I,w-1,E).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-start justify-center pt-[15vh] z-50",onClick:p,children:e.jsxs("div",{className:"bg-zinc-900 border border-amber-500/30 rounded-2xl shadow-2xl w-full max-w-xl mx-4 max-h-[60vh] flex flex-col overflow-hidden",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-white/10",children:[e.jsx(J,{className:"w-5 h-5 text-amber-400"}),e.jsx("input",{ref:u,type:"text",value:l,onChange:n=>o(n.target.value),placeholder:"Rechercher clients, RDV, services...",className:"flex-1 bg-transparent outline-none text-white text-lg placeholder:text-white/40"}),e.jsx("kbd",{className:"hidden sm:block px-2 py-0.5 text-xs text-white/40 bg-white/10 rounded border border-white/10",children:"ESC"}),e.jsx("button",{onClick:p,className:"p-1 hover:bg-white/10 rounded-lg transition",children:e.jsx(U,{className:"w-5 h-5 text-white/50"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3",children:[N&&e.jsx("div",{className:"text-center py-8 text-white/50",children:"Recherche..."}),!N&&l.length>=2&&!b&&e.jsxs("div",{className:"text-center py-8 text-white/50",children:['Aucun rÃ©sultat pour "',l,'"']}),!N&&b&&e.jsxs("div",{className:"space-y-4",children:[c.clients.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-semibold text-white/40 uppercase tracking-wider mb-2 px-2",children:"Clients"}),c.clients.map(n=>e.jsxs(z,{href:"/admin/clients",onClick:p,className:"flex items-center gap-3 p-2.5 hover:bg-white/5 rounded-xl transition cursor-pointer",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center",children:e.jsx(ue,{className:"w-4 h-4 text-blue-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-medium text-white text-sm",children:[n.prenom," ",n.nom]}),e.jsxs("div",{className:"text-xs text-white/50 truncate",children:[n.telephone,n.email?` Â· ${n.email}`:""]})]})]},n.id))]}),c.reservations.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-semibold text-white/40 uppercase tracking-wider mb-2 px-2",children:"Rendez-vous"}),c.reservations.map(n=>e.jsxs(z,{href:"/admin/planning",onClick:p,className:"flex items-center gap-3 p-2.5 hover:bg-white/5 rounded-xl transition cursor-pointer",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center",children:e.jsx(K,{className:"w-4 h-4 text-green-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-medium text-white text-sm",children:[C(n.date)," Ã  ",n.heure]}),e.jsxs("div",{className:"text-xs text-white/50 truncate",children:[n.clients?`${n.clients.prenom} ${n.clients.nom} Â· `:"",n.service_nom]})]}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full ${n.statut==="confirme"?"bg-green-500/20 text-green-400":"bg-amber-500/20 text-amber-400"}`,children:n.statut})]},n.id))]}),c.services.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-semibold text-white/40 uppercase tracking-wider mb-2 px-2",children:"Services"}),c.services.map(n=>e.jsxs(z,{href:"/admin/services",onClick:p,className:"flex items-center gap-3 p-2.5 hover:bg-white/5 rounded-xl transition cursor-pointer",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center",children:e.jsx(X,{className:"w-4 h-4 text-purple-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-white text-sm",children:n.nom}),e.jsxs("div",{className:"text-xs text-white/50",children:[n.prix,"â‚¬ Â· ",n.duree,"min"]})]})]},n.id))]})]})]})]})})}const De={businessName:"NEXUS",assistantName:"NEXUS",logoUrl:"",faviconUrl:"/favicon-nexus.svg",primaryColor:"#22d3ee",accentColor:"#3b82f6"};function Oe(){const[f,p]=t.useState(null);return t.useEffect(()=>{const l=localStorage.getItem("admin_token");l&&fetch("/api/admin/branding",{headers:{Authorization:`Bearer ${l}`}}).then(o=>o.json()).then(o=>{if(o.success&&o.branding){p(o.branding);const c=document.getElementById("favicon");c&&o.branding.faviconUrl&&(c.href=o.branding.faviconUrl),document.title=`${o.branding.businessName} | ${o.branding.assistantName} Pro`}}).catch(o=>{console.error("Branding fetch error:",o),p(De)})},[]),f}function st({children:f}){const p=()=>typeof window>"u"?!1:window.innerWidth<768,[l,o]=t.useState(()=>!p()),[c,y]=t.useState(p),[N,v]=t.useState(!1),[u,j]=oe(),b=Oe(),[C,n]=t.useState([]),I=[{id:"activite",label:"ActivitÃ©",icon:Ie,items:[{icon:X,label:"Services",path:"/admin/services"},{icon:K,label:"DisponibilitÃ©s",path:"/admin/disponibilites"},{icon:Ne,label:"Planning",path:"/admin/planning"},{icon:je,label:"RÃ©servations",path:"/admin/reservations"},{icon:pe,label:"Clients",path:"/admin/clients"},{icon:xe,label:"Commandes",path:"/admin/commandes"},{icon:fe,label:"Avis",path:"/admin/avis"}]},{id:"marketing",label:"Marketing",icon:$e,items:[{icon:Se,label:"Campagnes",path:"/admin/marketing"},{icon:Ce,label:"RÃ©seaux Sociaux",path:"/admin/social"},{icon:Re,label:"SEO",path:"/admin/seo"},{icon:W,label:"MÃ©dias IA",path:"/admin/media"}]},{id:"gestion",label:"Gestion",icon:ve,items:[{icon:Le,label:"Commercial",path:"/admin/commercial"},{icon:ze,label:"RH",path:"/admin/rh"},{icon:ke,label:"ComptabilitÃ©",path:"/admin/comptabilite"}]},{id:"ia",label:"Intelligence IA",icon:ge,items:[{icon:Ae,label:"Assistant IA",path:"/admin/chat"},{icon:ce,label:"Ã‰quipe IA",path:"/admin/equipe"}]},{id:"systeme",label:"SystÃ¨me",icon:Ue,items:[{icon:be,label:"Analytics",path:"/admin/analytics"},{icon:Fe,label:"Logs Halimah",path:"/admin/logs"},{icon:Ee,label:"Mes Modules",path:"/admin/modules"},{icon:de,label:"ParamÃ¨tres",path:"/admin/parametres"}]}],w=[{icon:he,label:"Dashboard",path:"/admin/dashboard"}];t.useEffect(()=>{const a=()=>{const d=window.innerWidth<768;y(d),o(!d)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),t.useEffect(()=>{const a=d=>{(d.metaKey||d.ctrlKey)&&d.key==="k"&&(d.preventDefault(),v(!0))};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[]),t.useEffect(()=>{c&&o(!1)},[u,c]),t.useEffect(()=>{for(const a of I)if(a.items.some(d=>u===d.path||u.startsWith(d.path+"/"))){n([a.id]);break}},[]);const E=(()=>{try{const a=localStorage.getItem("admin_user");return a?JSON.parse(a):{}}catch{return{}}})(),T=()=>{localStorage.removeItem("admin_token"),localStorage.removeItem("admin_user"),j("/admin/login")},R=a=>{n(d=>d.includes(a)?d.filter(k=>k!==a):[...d,a])},M=a=>u===a,$=a=>a.items.some(d=>u===d.path||u.startsWith(d.path+"/"));return e.jsxs("div",{className:"flex min-h-screen h-[100dvh] bg-zinc-950 overflow-hidden",children:[e.jsxs("div",{className:"fixed inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 african-pattern opacity-5"}),e.jsx("div",{className:"absolute top-1/4 right-0 w-96 h-96 bg-amber-500/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 left-1/3 w-80 h-80 bg-orange-500/5 rounded-full blur-3xl"})]}),c&&l&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-30 md:hidden",onClick:()=>o(!1)}),c&&!l&&e.jsx("button",{onClick:()=>o(!0),className:"fixed top-4 left-4 z-30 p-3 bg-zinc-900/90 backdrop-blur-xl border border-amber-500/30 rounded-xl text-white md:hidden",children:e.jsx(q,{size:24})}),e.jsxs("aside",{className:`
        ${c?`fixed inset-y-0 left-0 z-40 w-72 transform transition-transform duration-300 ${l?"translate-x-0":"-translate-x-full"}`:`${l?"w-72":"w-20"} relative z-20`}
        bg-zinc-900/95 backdrop-blur-xl border-r border-amber-500/20
        transition-all duration-300 flex flex-col
      `,children:[e.jsxs("div",{className:"p-4 flex items-center justify-between border-b border-amber-500/20",children:[l&&e.jsxs("div",{className:"flex items-center gap-3",children:[b?.logoUrl?e.jsx("img",{src:b.logoUrl,alt:b.businessName,className:"h-11 w-11"}):e.jsx("div",{className:"h-11 w-11 bg-gradient-to-br from-cyan-400 to-blue-600 rounded-xl flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-white",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polygon",{points:"12 2 22 8.5 22 15.5 12 22 2 15.5 2 8.5 12 2"})})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-lg font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500",children:[b?.assistantName||"NEXUS"," Pro"]}),e.jsx("p",{className:"text-xs text-white/50",children:b?.businessName||"Administration"})]})]}),e.jsx("button",{onClick:()=>o(!l),className:"p-2 hover:bg-white/10 rounded-lg transition text-white/70 hover:text-white",children:l?e.jsx(U,{size:20}):e.jsx(q,{size:20})})]}),l&&e.jsx("div",{className:"px-4 pt-3",children:e.jsxs("button",{onClick:()=>v(!0),className:"w-full flex items-center gap-2 px-3 py-2 bg-white/5 border border-white/10 hover:border-amber-500/30 rounded-xl text-white/50 hover:text-white/70 transition-all text-sm",children:[e.jsx(J,{size:16}),e.jsx("span",{className:"flex-1 text-left",children:"Rechercher..."}),e.jsx("kbd",{className:"text-[10px] px-1.5 py-0.5 bg-white/10 rounded border border-white/10",children:"âŒ˜K"})]})}),e.jsxs("nav",{className:"flex-1 p-3 space-y-1 overflow-y-auto scrollbar-thin scrollbar-thumb-white/10",children:[w.map(a=>{const d=a.icon,k=M(a.path);return e.jsxs(z,{href:a.path,className:`
                  flex items-center gap-3 px-3 py-2.5 rounded-xl transition-all
                  ${k?"bg-gradient-to-r from-amber-500 to-orange-500 text-white font-semibold shadow-lg shadow-amber-500/30":"text-white/60 hover:bg-white/10 hover:text-white"}
                  ${!l&&"justify-center"}
                `,children:[e.jsx(d,{size:20}),l&&e.jsx("span",{children:a.label})]},a.path)}),l?e.jsx("div",{className:"space-y-1 pt-2",children:I.map(a=>{const d=a.icon,k=C.includes(a.id),S=$(a);return e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("button",{onClick:()=>R(a.id),className:`
                        w-full flex items-center gap-3 px-3 py-2.5 rounded-xl transition-all
                        ${S&&!k?"bg-amber-500/20 text-amber-400":"text-white/50 hover:bg-white/5 hover:text-white/70"}
                      `,children:[e.jsx(d,{size:18,className:S?"text-amber-400":""}),e.jsx("span",{className:"flex-1 text-left text-sm font-medium",children:a.label}),k?e.jsx(me,{size:16,className:"text-white/40"}):e.jsx(we,{size:16,className:"text-white/40"})]}),k&&e.jsx("div",{className:"ml-3 pl-3 border-l border-white/10 space-y-0.5",children:a.items.map(F=>{const B=F.icon,L=M(F.path);return e.jsxs(z,{href:F.path,className:`
                                flex items-center gap-3 px-3 py-2 rounded-lg transition-all text-sm
                                ${L?"bg-gradient-to-r from-amber-500 to-orange-500 text-white font-medium shadow-md shadow-amber-500/20":"text-white/50 hover:bg-white/10 hover:text-white"}
                              `,children:[e.jsx(B,{size:16}),e.jsx("span",{children:F.label})]},F.path)})})]},a.id)})}):e.jsx("div",{className:"space-y-1 pt-2",children:I.map(a=>{const d=a.icon,k=$(a),S=a.items[0];return e.jsx(z,{href:S.path,className:`
                      flex items-center justify-center p-3 rounded-xl transition-all
                      ${k?"bg-gradient-to-r from-amber-500 to-orange-500 text-white shadow-lg shadow-amber-500/30":"text-white/50 hover:bg-white/10 hover:text-white"}
                    `,title:a.label,children:e.jsx(d,{size:20})},a.id)})})]}),e.jsxs("div",{className:"p-4 border-t border-amber-500/20",children:[e.jsxs("div",{className:`flex items-center gap-3 ${!l&&"justify-center"}`,children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-600 rounded-full flex items-center justify-center font-bold text-white shadow-lg shadow-amber-500/30",children:E.nom?.[0]||"F"}),l&&e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-white truncate",children:E.nom||"Admin"}),e.jsx("p",{className:"text-xs text-white/50 truncate",children:E.email})]})]}),e.jsxs("button",{onClick:T,className:`
              mt-3 w-full flex items-center gap-2 px-3 py-2
              bg-white/5 border border-white/10 hover:bg-red-500/20 hover:border-red-500/30
              text-white/70 hover:text-red-400 rounded-xl transition-all
              ${!l&&"justify-center"}
            `,children:[e.jsx(ye,{size:18}),l&&e.jsx("span",{children:"DÃ©connexion"})]})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto overflow-x-hidden relative z-10 w-full min-w-0",children:e.jsx("div",{className:`p-4 md:p-8 pb-20 ${c?"pt-16":""}`,children:f})}),e.jsx(Te,{}),e.jsx(Pe,{}),e.jsx(Be,{open:N,onClose:()=>v(!1)})]})}export{st as A,je as C,Se as M,Ee as P,Ie as S,$e as T,Le as U,Ne as a,Re as b,Ce as c};
