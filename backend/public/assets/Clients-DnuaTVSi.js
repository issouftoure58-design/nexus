import{a as W,r,j as e,B as o,t as Y,X as Z}from"./index-_yXYEqcL.js";import{A as ee,T as te}from"./AdminLayout-CTeGiCEF.js";import{I as p}from"./input-TVuV-KxK.js";import{T as se}from"./textarea-C1wLWZvj.js";import{e as re}from"./exportCsv-B62shLnH.js";import{U as P}from"./users-DLPfMp13.js";import{a as ae}from"./settings-BkyowQvs.js";import{P as ie}from"./phone-DqBiH1an.js";import{M as ne}from"./mail-N-gOIhL7.js";import{E as le}from"./eye-CvXJPXHv.js";import{C as oe}from"./chevron-left-DzjsD1u5.js";import{C as de}from"./chevron-right-DPdOXaL5.js";import{F as $}from"./file-text-DGGLtmm2.js";import{C as ce}from"./calendar-NWhThMGY.js";import{S as me}from"./save-B2MQZ1Te.js";import{S as xe}from"./square-pen-C-bOmknF.js";import{T as pe}from"./trash-2-CXbRkBbN.js";import"./image-nfPd-l1I.js";import"./user-Ai5-1aUm.js";import"./scissors-DPHsfmq1.js";import"./shopping-bag-CEo4UOGG.js";import"./message-square-BHRNNhOm.js";import"./sparkles-BX8nnFHk.js";import"./chart-column-eauyrf0D.js";import"./log-out-CvuSphzZ.js";function Fe(){const{toast:c}=W(),[N,q]=r.useState([]),[i,C]=r.useState(null),[h,V]=r.useState(""),[u,S]=r.useState(1),[v,F]=r.useState(1),[E,B]=r.useState(0),[M,_]=r.useState(!0),[L,T]=r.useState(!1),[g,A]=r.useState("infos"),[d,D]=r.useState(null),[b,y]=r.useState([]),[z,R]=r.useState([]),[w,k]=r.useState(""),[m,j]=r.useState(!1),[l,x]=r.useState({nom:"",prenom:"",telephone:"",email:"",adresse:""});r.useEffect(()=>{I()},[h,u]);const I=async()=>{_(!0);try{const t=localStorage.getItem("admin_token"),s=new URLSearchParams({page:u.toString(),limit:"20",sort:"created_at",order:"desc"});h&&s.append("search",h);const n=await fetch(`/api/admin/clients?${s}`,{headers:{Authorization:`Bearer ${t}`}});if(!n.ok)throw new Error("Erreur lors du chargement des clients");const a=await n.json();q(a.clients||[]),F(a.pagination?.pages||1),B(a.pagination?.total||0)}catch(t){console.error("Erreur:",t),c({title:"Erreur",description:"Impossible de charger les clients",variant:"destructive"})}finally{_(!1)}},U=async t=>{try{const s=localStorage.getItem("admin_token"),n=await fetch(`/api/admin/clients/${t}`,{headers:{Authorization:`Bearer ${s}`}});if(!n.ok)throw new Error("Erreur lors du chargement des détails");const a=await n.json();C(a.client),D(a.stats),y(a.notes||[]),R(a.historique_rdv||[]),x({nom:a.client.nom||"",prenom:a.client.prenom||"",telephone:a.client.telephone||"",email:a.client.email||"",adresse:a.client.adresse||""})}catch(s){console.error("Erreur:",s),c({title:"Erreur",description:"Impossible de charger les détails du client",variant:"destructive"})}},O=async t=>{T(!0),A("infos"),j(!1),await U(t.id)},H=()=>{T(!1),C(null),D(null),y([]),R([]),k(""),j(!1)},J=async()=>{if(i)try{const t=localStorage.getItem("admin_token"),s=await fetch(`/api/admin/clients/${i.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(l)});if(!s.ok)throw new Error("Erreur lors de la modification");const n=await s.json();C(n.client),j(!1),c({title:"Succès",description:"Client modifié avec succès"}),I()}catch(t){console.error("Erreur:",t),c({title:"Erreur",description:"Impossible de modifier le client",variant:"destructive"})}},X=async()=>{if(!(!i||!w.trim()))try{const t=localStorage.getItem("admin_token"),s=await fetch(`/api/admin/clients/${i.id}/notes`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({note:w.trim()})});if(!s.ok)throw new Error("Erreur lors de l'ajout de la note");const n=await s.json();y([n.note,...b]),k(""),c({title:"Succès",description:"Note ajoutée"})}catch(t){console.error("Erreur:",t),c({title:"Erreur",description:"Impossible d'ajouter la note",variant:"destructive"})}},G=async t=>{if(i&&confirm("Supprimer cette note ?"))try{const s=localStorage.getItem("admin_token");if(!(await fetch(`/api/admin/clients/${i.id}/notes/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}})).ok)throw new Error("Erreur lors de la suppression");y(b.filter(a=>a.id!==t)),c({title:"Succès",description:"Note supprimée"})}catch(s){console.error("Erreur:",s),c({title:"Erreur",description:"Impossible de supprimer la note",variant:"destructive"})}},f=t=>t?new Date(t).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",K=t=>{const s={confirme:"bg-blue-100 text-blue-800",termine:"bg-green-100 text-green-800",annule:"bg-red-100 text-red-800",en_attente:"bg-yellow-100 text-yellow-800",no_show:"bg-gray-100 text-gray-800"},n={confirme:"Confirmé",termine:"Terminé",annule:"Annulé",en_attente:"En attente",no_show:"Absent"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s[t]||"bg-gray-100 text-gray-800"}`,children:n[t]||t})},Q=()=>{const t=N.map(s=>({Prénom:s.prenom,Nom:s.nom,Téléphone:s.telephone,Email:s.email||"","Nb RDV":s.nb_rdv,"Dernier RDV":s.dernier_rdv?f(s.dernier_rdv.date):"Aucun"}));re(t,"clients")};return e.jsx(ee,{children:e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-purple-100 to-pink-100 rounded-lg",children:e.jsx(P,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Clients"}),e.jsxs("p",{className:"text-gray-600",children:[E," client",E>1?"s":""]})]})]}),e.jsxs(o,{onClick:Q,disabled:N.length===0,className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Exporter CSV"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx(p,{type:"text",placeholder:"Rechercher par nom, téléphone ou email...",value:h,onChange:t=>{V(t.target.value),S(1)},className:"pl-10"})]})]}),M?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Chargement..."})]}):N.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg shadow",children:[e.jsx(P,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:h?"Aucun client trouvé":"Aucun client pour le moment"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gradient-to-r from-purple-50 to-pink-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Client"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Nb RDV"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Dernier RDV"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-white font-semibold",children:[t.prenom?.[0],t.nom?.[0]]})}),e.jsx("div",{className:"ml-4",children:e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[t.prenom," ",t.nom]})})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm text-gray-900 flex items-center gap-1",children:[e.jsx(ie,{className:"w-4 h-4 text-gray-400"}),t.telephone]}),t.email&&e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-1 mt-1",children:[e.jsx(ne,{className:"w-4 h-4 text-gray-400"}),t.email]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm font-semibold text-purple-600",children:t.nb_rdv})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.dernier_rdv?e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900",children:f(t.dernier_rdv.date)}),e.jsx("div",{className:"text-xs text-gray-500",children:t.dernier_rdv.service})]}):e.jsx("span",{className:"text-sm text-gray-400",children:"Aucun RDV"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs(o,{onClick:()=>O(t),variant:"ghost",size:"sm",className:"text-purple-600 hover:text-purple-900",children:[e.jsx(le,{className:"w-4 h-4 mr-1"}),"Voir"]})})]},t.id))})]})}),v>1&&e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Page ",u," sur ",v]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{onClick:()=>S(t=>Math.max(1,t-1)),disabled:u===1,variant:"outline",size:"sm",children:[e.jsx(oe,{className:"w-4 h-4 mr-1"}),"Précédent"]}),e.jsxs(o,{onClick:()=>S(t=>Math.min(v,t+1)),disabled:u===v,variant:"outline",size:"sm",children:["Suivant",e.jsx(de,{className:"w-4 h-4 ml-1"})]})]})]})]}),L&&i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col ml-56",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between bg-gradient-to-r from-purple-50 to-pink-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-white font-semibold text-lg",children:[i.prenom?.[0],i.nom?.[0]]})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:[i.prenom," ",i.nom]}),e.jsx("p",{className:"text-sm text-gray-600",children:i.telephone})]})]}),e.jsx(o,{onClick:H,variant:"ghost",size:"sm",children:e.jsx(Z,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"border-b border-gray-200 px-6",children:e.jsx("div",{className:"flex gap-4",children:[{id:"infos",label:"Informations",icon:$},{id:"historique",label:"Historique",icon:ce},{id:"notes",label:"Notes",icon:$},{id:"stats",label:"Statistiques",icon:te}].map(t=>e.jsxs("button",{onClick:()=>A(t.id),className:`flex items-center gap-2 px-4 py-3 border-b-2 transition-colors ${g===t.id?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:[e.jsx(t.icon,{className:"w-4 h-4"}),t.label]},t.id))})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[g==="infos"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:m?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{onClick:J,size:"sm",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Enregistrer"]}),e.jsx(o,{onClick:()=>j(!1),variant:"outline",size:"sm",children:"Annuler"})]}):e.jsxs(o,{onClick:()=>j(!0),size:"sm",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Modifier"]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prénom"}),e.jsx(p,{value:l.prenom,onChange:t=>x({...l,prenom:t.target.value}),disabled:!m})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nom"}),e.jsx(p,{value:l.nom,onChange:t=>x({...l,nom:t.target.value}),disabled:!m})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Téléphone"}),e.jsx(p,{value:l.telephone,onChange:t=>x({...l,telephone:t.target.value}),disabled:!m})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx(p,{type:"email",value:l.email,onChange:t=>x({...l,email:t.target.value}),disabled:!m})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Adresse"}),e.jsx(p,{value:l.adresse,onChange:t=>x({...l,adresse:t.target.value}),disabled:!m})]})]}),i.derniere_visite&&e.jsx("div",{className:"mt-6 p-4 bg-purple-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Dernière visite : ",f(i.derniere_visite)]})})]}),g==="historique"&&e.jsx("div",{className:"space-y-4",children:z.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Aucun rendez-vous"}):z.map(t=>e.jsx("div",{className:"p-4 border border-gray-200 rounded-lg hover:border-purple-300 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.service}),e.jsxs("p",{className:"text-sm text-gray-600",children:[f(t.date)," à ",t.heure]})]}),K(t.statut)]})},t.id))}),g==="notes"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx(se,{placeholder:"Ajouter une note privée...",value:w,onChange:t=>k(t.target.value),rows:3,className:"mb-2"}),e.jsx(o,{onClick:X,disabled:!w.trim(),size:"sm",children:"Ajouter la note"})]}),b.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Aucune note"}):b.map(t=>e.jsx("div",{className:"p-4 border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-900 whitespace-pre-wrap",children:t.note}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[f(t.created_at)," à"," ",new Date(t.created_at).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})]})]}),e.jsx(o,{onClick:()=>G(t.id),variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-900",children:e.jsx(pe,{className:"w-4 h-4"})})]})},t.id))]}),g==="stats"&&d&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-lg",children:[e.jsx("p",{className:"text-sm text-green-700 font-medium",children:"Chiffre d'affaires"}),e.jsxs("p",{className:"text-2xl font-bold text-green-900 mt-1",children:[d.ca_total.toFixed(2)," €"]})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg",children:[e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Total RDV"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900 mt-1",children:d.nb_rdv_total})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg",children:[e.jsx("p",{className:"text-sm text-purple-700 font-medium",children:"RDV Honorés"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900 mt-1",children:d.nb_rdv_honores})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-br from-red-50 to-red-100 rounded-lg",children:[e.jsx("p",{className:"text-sm text-red-700 font-medium",children:"RDV Annulés"}),e.jsx("p",{className:"text-2xl font-bold text-red-900 mt-1",children:d.nb_rdv_annules})]})]}),d.service_favori&&e.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:[e.jsx("p",{className:"text-sm text-yellow-700 font-medium",children:"Service favori"}),e.jsx("p",{className:"text-lg font-semibold text-yellow-900 mt-1",children:d.service_favori})]}),d.frequence_jours&&e.jsxs("div",{className:"p-4 bg-indigo-50 rounded-lg border border-indigo-200",children:[e.jsx("p",{className:"text-sm text-indigo-700 font-medium",children:"Fréquence moyenne"}),e.jsxs("p",{className:"text-lg font-semibold text-indigo-900 mt-1",children:["Tous les ",d.frequence_jours," jours"]})]})]})]})]})})]})})}export{Fe as default};
