import{a as H,r as n,j as e,B as l,t as G,H as E}from"./index-_yXYEqcL.js";import{A as J,P as T}from"./AdminLayout-CTeGiCEF.js";import{S as f}from"./shopping-bag-CEo4UOGG.js";import{C as V}from"./clock-xh9IAeUk.js";import{C as u}from"./circle-check-DHSvjqNQ.js";import{E as X}from"./euro-BOxFFLgt.js";import{F as q}from"./filter-DLEMKo89.js";import{C as g}from"./calendar-NWhThMGY.js";import{B as z}from"./building-DNdEBFCU.js";import{C as A}from"./credit-card-BzWzjUVE.js";import{E as K}from"./eye-CvXJPXHv.js";import{C as v}from"./circle-x-CE1ZE8zE.js";import{T as Q}from"./trash-2-CXbRkBbN.js";import{C as W}from"./chevron-left-DzjsD1u5.js";import{C as Y}from"./chevron-right-DPdOXaL5.js";import{U as Z}from"./user-Ai5-1aUm.js";import{P as ee}from"./phone-DqBiH1an.js";import{M as te}from"./mail-N-gOIhL7.js";import"./file-text-DGGLtmm2.js";import"./image-nfPd-l1I.js";import"./settings-BkyowQvs.js";import"./scissors-DPHsfmq1.js";import"./users-DLPfMp13.js";import"./message-square-BHRNNhOm.js";import"./sparkles-BX8nnFHk.js";import"./chart-column-eauyrf0D.js";import"./log-out-CvuSphzZ.js";const P={en_attente:"bg-amber-500/20 text-amber-400 border border-amber-500/30",confirme:"bg-blue-500/20 text-blue-400 border border-blue-500/30",paye:"bg-emerald-500/20 text-emerald-400 border border-emerald-500/30",termine:"bg-emerald-500/20 text-emerald-400 border border-emerald-500/30",annule:"bg-red-500/20 text-red-400 border border-red-500/30"},C={en_attente:"En attente",confirme:"Confirmée",paye:"Payée",termine:"Terminée",annule:"Annulée"},F={sur_place:"Sur place",stripe:"Carte bancaire",paypal:"PayPal"};function Te(){const{toast:o}=H(),[_,L]=n.useState([]),[i,j]=n.useState({periode:"semaine",statut:"tous",paiement:"tous"}),[c,y]=n.useState(1),[w,$]=n.useState(1),[D,k]=n.useState(!0),[p,B]=n.useState({total:0,en_attente:0,confirme:0,ca_total:0}),[O,m]=n.useState(!1),[s,R]=n.useState(null);n.useEffect(()=>{b(),N()},[i,c]);const b=async()=>{k(!0);try{const t=localStorage.getItem("admin_token"),a=new URLSearchParams({page:c.toString(),limit:"20",...i.statut!=="tous"&&{statut:i.statut},...i.paiement!=="tous"&&{paiement:i.paiement},periode:i.periode}),r=await fetch(`/api/admin/orders?${a}`,{headers:{Authorization:`Bearer ${t}`}});if(!r.ok)throw new Error("Erreur chargement commandes");const h=await r.json();L(h.orders||[]),$(h.totalPages||1)}catch(t){console.error("Erreur:",t),o({title:"Erreur",description:"Impossible de charger les commandes",variant:"destructive"})}finally{k(!1)}},N=async()=>{try{const t=localStorage.getItem("admin_token"),a=await fetch("/api/admin/orders/stats",{headers:{Authorization:`Bearer ${t}`}});if(a.ok){const r=await a.json();B(r)}}catch(t){console.error("Erreur stats:",t)}},x=async(t,a)=>{try{const r=localStorage.getItem("admin_token");if(!(await fetch(`/api/admin/orders/${t}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({statut:a})})).ok)throw new Error("Erreur mise à jour");o({title:"Statut mis à jour",description:`Commande #${t} : ${C[a]}`}),b(),N()}catch{o({title:"Erreur",description:"Impossible de mettre à jour le statut",variant:"destructive"})}},I=async t=>{try{const a=localStorage.getItem("admin_token"),r=await fetch(`/api/orders/${t}`,{headers:{Authorization:`Bearer ${a}`}});if(!r.ok)throw new Error("Erreur");const h=await r.json();R(h.order),m(!0)}catch{o({title:"Erreur",description:"Impossible de charger la commande",variant:"destructive"})}},M=async t=>{if(confirm(`Êtes-vous sûr de vouloir supprimer la commande #${t} ?

Cette action est irréversible.`))try{const a=localStorage.getItem("admin_token");if(!(await fetch(`/api/admin/orders/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).ok)throw new Error("Erreur suppression");o({title:"Commande supprimée",description:`La commande #${t} a été supprimée`}),b(),N()}catch{o({title:"Erreur",description:"Impossible de supprimer la commande",variant:"destructive"})}},d=t=>(t/100).toFixed(2)+" €",S=t=>new Date(t).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short"}),U=t=>new Date(t).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs(J,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-white flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-amber-500 to-orange-600 rounded-xl",children:e.jsx(f,{className:"h-6 w-6 text-white"})}),"Commandes"]}),e.jsx("p",{className:"text-white/60 mt-1",children:"Gérez les commandes passées via le panier"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(l,{variant:"outline",className:"border-white/20 bg-white/5 text-white hover:bg-white/10",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Exporter"]})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsx("div",{className:"bg-white/5 backdrop-blur-sm border border-white/10 rounded-2xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500/20 rounded-xl",children:e.jsx(T,{className:"h-5 w-5 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:p.total})]})]})}),e.jsx("div",{className:"bg-white/5 backdrop-blur-sm border border-white/10 rounded-2xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-500/20 rounded-xl",children:e.jsx(V,{className:"h-5 w-5 text-amber-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm",children:"En attente"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:p.en_attente})]})]})}),e.jsx("div",{className:"bg-white/5 backdrop-blur-sm border border-white/10 rounded-2xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-500/20 rounded-xl",children:e.jsx(u,{className:"h-5 w-5 text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm",children:"Confirmées"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:p.confirme})]})]})}),e.jsx("div",{className:"bg-white/5 backdrop-blur-sm border border-white/10 rounded-2xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-amber-500 to-orange-500 rounded-xl",children:e.jsx(X,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm",children:"CA Total"}),e.jsx("p",{className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-500",children:d(p.ca_total)})]})]})})]}),e.jsx("div",{className:"bg-white/5 backdrop-blur-sm border border-white/10 rounded-2xl p-4 mb-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-white/60"}),e.jsx("span",{className:"text-white/60 text-sm",children:"Filtres:"})]}),e.jsxs("select",{value:i.periode,onChange:t=>j({...i,periode:t.target.value}),className:"bg-white/10 border border-white/20 rounded-lg px-3 py-1.5 text-white text-sm focus:outline-none focus:border-amber-500/50",children:[e.jsx("option",{value:"aujourd_hui",children:"Aujourd'hui"}),e.jsx("option",{value:"semaine",children:"Cette semaine"}),e.jsx("option",{value:"mois",children:"Ce mois"}),e.jsx("option",{value:"tous",children:"Tous"})]}),e.jsxs("select",{value:i.statut,onChange:t=>j({...i,statut:t.target.value}),className:"bg-white/10 border border-white/20 rounded-lg px-3 py-1.5 text-white text-sm focus:outline-none focus:border-amber-500/50",children:[e.jsx("option",{value:"tous",children:"Tous statuts"}),e.jsx("option",{value:"en_attente",children:"En attente"}),e.jsx("option",{value:"confirme",children:"Confirmée"}),e.jsx("option",{value:"termine",children:"Terminée"}),e.jsx("option",{value:"annule",children:"Annulée"})]}),e.jsxs("select",{value:i.paiement,onChange:t=>j({...i,paiement:t.target.value}),className:"bg-white/10 border border-white/20 rounded-lg px-3 py-1.5 text-white text-sm focus:outline-none focus:border-amber-500/50",children:[e.jsx("option",{value:"tous",children:"Tous paiements"}),e.jsx("option",{value:"sur_place",children:"Sur place"}),e.jsx("option",{value:"stripe",children:"Carte bancaire"}),e.jsx("option",{value:"paypal",children:"PayPal"})]})]})}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-sm border border-white/10 rounded-2xl overflow-hidden",children:[D?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"h-8 w-8 border-2 border-amber-500/30 border-t-amber-500 rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"text-white/60 mt-4",children:"Chargement..."})]}):_.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(f,{className:"h-12 w-12 text-white/20 mx-auto mb-4"}),e.jsx("p",{className:"text-white/60",children:"Aucune commande trouvée"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("th",{className:"text-left p-4 text-white/60 font-medium text-sm",children:"#"}),e.jsx("th",{className:"text-left p-4 text-white/60 font-medium text-sm",children:"Date RDV"}),e.jsx("th",{className:"text-left p-4 text-white/60 font-medium text-sm",children:"Client"}),e.jsx("th",{className:"text-left p-4 text-white/60 font-medium text-sm",children:"Services"}),e.jsx("th",{className:"text-left p-4 text-white/60 font-medium text-sm",children:"Lieu"}),e.jsx("th",{className:"text-left p-4 text-white/60 font-medium text-sm",children:"Total"}),e.jsx("th",{className:"text-left p-4 text-white/60 font-medium text-sm",children:"Paiement"}),e.jsx("th",{className:"text-left p-4 text-white/60 font-medium text-sm",children:"Statut"}),e.jsx("th",{className:"text-left p-4 text-white/60 font-medium text-sm",children:"Actions"})]})}),e.jsx("tbody",{children:_.map(t=>e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"p-4",children:e.jsxs("span",{className:"text-white font-medium",children:["#",t.id]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-4 w-4 text-amber-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-sm",children:S(t.date_rdv)}),e.jsx("p",{className:"text-white/50 text-xs",children:t.heure_debut})]})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-white text-sm",children:[t.client_prenom," ",t.client_nom]}),e.jsx("p",{className:"text-white/50 text-xs",children:t.client_telephone})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"max-w-[200px]",children:[t.order_items?.slice(0,2).map((a,r)=>e.jsx("p",{className:"text-white/80 text-sm truncate",children:a.service_nom},r)),t.order_items?.length>2&&e.jsxs("p",{className:"text-white/50 text-xs",children:["+",t.order_items.length-2," autre(s)"]})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-1",children:[t.lieu==="chez_fatou"?e.jsx(z,{className:"h-4 w-4 text-blue-400"}):e.jsx(E,{className:"h-4 w-4 text-amber-400"}),e.jsx("span",{className:"text-white/80 text-sm",children:t.lieu==="chez_fatou"?"Chez Fatou":"Domicile"})]})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"text-white font-semibold",children:d(t.total)})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"h-4 w-4 text-white/40"}),e.jsx("span",{className:"text-white/80 text-sm",children:F[t.paiement_methode]||t.paiement_methode})]})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${P[t.statut]||"bg-white/10 text-white/60"}`,children:C[t.statut]||t.statut})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(l,{variant:"ghost",size:"icon",className:"h-8 w-8 text-white/60 hover:text-white hover:bg-white/10",onClick:()=>I(t.id),children:e.jsx(K,{className:"h-4 w-4"})}),t.statut==="en_attente"&&e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"ghost",size:"icon",className:"h-8 w-8 text-emerald-400 hover:text-emerald-300 hover:bg-emerald-500/20",onClick:()=>x(t.id,"confirme"),children:e.jsx(u,{className:"h-4 w-4"})}),e.jsx(l,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-400 hover:text-red-300 hover:bg-red-500/20",onClick:()=>x(t.id,"annule"),children:e.jsx(v,{className:"h-4 w-4"})})]}),t.statut==="confirme"&&e.jsx(l,{variant:"ghost",size:"icon",className:"h-8 w-8 text-emerald-400 hover:text-emerald-300 hover:bg-emerald-500/20",onClick:()=>x(t.id,"termine"),children:e.jsx(u,{className:"h-4 w-4"})}),e.jsx(l,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-400 hover:text-red-300 hover:bg-red-500/20",onClick:()=>M(t.id),title:"Supprimer",children:e.jsx(Q,{className:"h-4 w-4"})})]})})]},t.id))})]})}),w>1&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-white/10",children:[e.jsxs("p",{className:"text-white/60 text-sm",children:["Page ",c," sur ",w]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",disabled:c===1,onClick:()=>y(c-1),className:"border-white/20 text-white hover:bg-white/10",children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",disabled:c===w,onClick:()=>y(c+1),className:"border-white/20 text-white hover:bg-white/10",children:e.jsx(Y,{className:"h-4 w-4"})})]})]})]}),O&&s&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-zinc-900 border border-white/10 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-white/10",children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(f,{className:"h-5 w-5 text-amber-400"}),"Commande #",s.id]}),e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>m(!1),className:"text-white/60 hover:text-white hover:bg-white/10",children:e.jsx(v,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("span",{className:`px-3 py-1.5 rounded-full text-sm font-medium ${P[s.statut]}`,children:C[s.statut]}),e.jsxs("span",{className:"text-white/60 text-sm flex items-center gap-2",children:[e.jsx(g,{className:"h-4 w-4"}),"Créée le ",U(s.created_at)]})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4 text-amber-400"}),"Client"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60",children:"Nom"}),e.jsxs("p",{className:"text-white",children:[s.client_prenom," ",s.client_nom]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60",children:"Téléphone"}),e.jsxs("p",{className:"text-white flex items-center gap-1",children:[e.jsx(ee,{className:"h-3 w-3"}),s.client_telephone]})]}),s.client_email&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-white/60",children:"Email"}),e.jsxs("p",{className:"text-white flex items-center gap-1",children:[e.jsx(te,{className:"h-3 w-3"}),s.client_email]})]})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx(g,{className:"h-4 w-4 text-amber-400"}),"Rendez-vous"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60",children:"Date"}),e.jsx("p",{className:"text-white",children:S(s.date_rdv)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60",children:"Heure"}),e.jsx("p",{className:"text-white",children:s.heure_debut})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-white/60",children:"Lieu"}),e.jsx("p",{className:"text-white flex items-center gap-1",children:s.lieu==="chez_fatou"?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-3 w-3 text-blue-400"}),"Chez Fatou - 8 rue des Monts Rouges, Franconville"]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-3 w-3 text-amber-400"}),s.adresse_client]})})]})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4 text-amber-400"}),"Services"]}),e.jsx("div",{className:"space-y-2",children:s.order_items?.map(t=>e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-white/5 last:border-0",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white",children:t.service_nom}),e.jsxs("p",{className:"text-white/50 text-xs",children:[t.duree_minutes," min"]})]}),e.jsx("p",{className:"text-white font-medium",children:d(t.prix)})]},t.id))})]}),e.jsxs("div",{className:"bg-gradient-to-r from-amber-500/20 to-orange-500/20 border border-amber-500/30 rounded-xl p-4",children:[e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/60",children:"Sous-total"}),e.jsx("span",{className:"text-white",children:d(s.sous_total)})]}),s.frais_deplacement>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/60",children:"Frais de déplacement"}),e.jsx("span",{className:"text-white",children:d(s.frais_deplacement)})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t border-white/10",children:[e.jsx("span",{className:"text-white font-semibold",children:"Total"}),e.jsx("span",{className:"text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-500",children:d(s.total)})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-white/10 flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4 text-white/60"}),e.jsxs("span",{className:"text-white/80 text-sm",children:[F[s.paiement_methode]," -"," ",s.paiement_statut==="en_attente"?"En attente":"Payé"]})]})]}),s.notes&&e.jsxs("div",{className:"bg-white/5 rounded-xl p-4",children:[e.jsx("h3",{className:"text-white font-semibold mb-2",children:"Notes"}),e.jsx("p",{className:"text-white/80 text-sm",children:s.notes})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-6 border-t border-white/10",children:[e.jsx(l,{variant:"outline",onClick:()=>m(!1),className:"border-white/20 text-white hover:bg-white/10",children:"Fermer"}),s.statut==="en_attente"&&e.jsxs(e.Fragment,{children:[e.jsxs(l,{variant:"outline",onClick:()=>{x(s.id,"annule"),m(!1)},className:"border-red-500/30 text-red-400 hover:bg-red-500/20",children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),"Annuler"]}),e.jsxs(l,{onClick:()=>{x(s.id,"confirme"),m(!1)},className:"bg-gradient-to-r from-amber-500 to-orange-500 text-white",children:[e.jsx(u,{className:"h-4 w-4 mr-2"}),"Confirmer"]})]})]})]})})]})}export{Te as default};
