import{r as l,j as e,S as j,X as O,L as S}from"./index-_yXYEqcL.js";import{A as q,U as _,T as G}from"./AdminLayout-CTeGiCEF.js";import{P as X}from"./plus-D6ktc07k.js";import{C as k}from"./crown-Cr3ZmFVX.js";import{E as A}from"./euro-BOxFFLgt.js";import{U as I}from"./users-DLPfMp13.js";import{M as h}from"./mail-N-gOIhL7.js";import{F as J}from"./filter-DLEMKo89.js";import{C as H}from"./calendar-NWhThMGY.js";import{C as K}from"./clock-xh9IAeUk.js";import{C as Q}from"./chart-column-eauyrf0D.js";import{G as z}from"./gift-xaN3R6ak.js";import{P as R}from"./phone-DqBiH1an.js";import{S as W}from"./sparkles-BX8nnFHk.js";import{S as Y}from"./star-nlKRpWv2.js";import{A as Z}from"./award-CWNTBZ19.js";import"./file-text-DGGLtmm2.js";import"./image-nfPd-l1I.js";import"./settings-BkyowQvs.js";import"./user-Ai5-1aUm.js";import"./scissors-DPHsfmq1.js";import"./shopping-bag-CEo4UOGG.js";import"./message-square-BHRNNhOm.js";import"./chevron-right-DPdOXaL5.js";import"./log-out-CvuSphzZ.js";function Se(){const[d,F]=l.useState("clients"),[i,P]=l.useState([]),[N,$]=l.useState([]),[n,E]=l.useState(null),[T,w]=l.useState(!0),[b,D]=l.useState(3),[p,M]=l.useState("all"),[L,c]=l.useState(!1),[a,m]=l.useState(null),[x,v]=l.useState(!1);l.useEffect(()=>{U()},[b]);const U=async()=>{w(!0);const t={Authorization:`Bearer ${localStorage.getItem("admin_token")}`};try{const[r,f,g]=await Promise.all([fetch(`/api/commercial/clients/inactifs?periode=${b}`,{headers:t}).then(o=>o.json()).catch(()=>({clients_inactifs:[]})),fetch("/api/commercial/campagnes",{headers:t}).then(o=>o.json()).catch(()=>({campagnes:[]})),fetch("/api/commercial/stats",{headers:t}).then(o=>o.json()).catch(()=>null)]);P(r.clients_inactifs||[]),$(f.campagnes||[]),E(g)}catch(r){console.error("Erreur chargement commercial:",r)}finally{w(!1)}},u=async s=>{m(s),c(!0)},y=async s=>{if(a){v(!0);try{const t=localStorage.getItem("admin_token");await fetch("/api/commercial/relance",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({client_id:a.id,method:s,offre:a.offre_suggeree})}),c(!1),m(null)}catch(t){console.error("Erreur relance:",t)}finally{v(!1)}}},V=s=>{const t={vip:{icon:k,color:"bg-amber-500/20 text-amber-400 border-amber-500/30",label:"VIP"},fidele:{icon:Z,color:"bg-blue-500/20 text-blue-400 border-blue-500/30",label:"Fidèle"},standard:{icon:Y,color:"bg-white/10 text-white/60 border-white/20",label:"Standard"}},{icon:r,color:f,label:g}=t[s]||t.standard;return e.jsxs("span",{className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium border ${f}`,children:[e.jsx(r,{className:"w-3 h-3"}),g]})},B=s=>{const t={leger:"bg-yellow-500/20 text-yellow-400",moyen:"bg-orange-500/20 text-orange-400",fort:"bg-red-500/20 text-red-400"},r={leger:"Récent",moyen:"Modéré",fort:"Critique"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t[s]||t.leger}`,children:r[s]||s})},C=p==="all"?i:i.filter(s=>s.segment===p);return e.jsxs(q,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(_,{className:"w-7 h-7 text-amber-400"}),"Commercial"]}),e.jsx("p",{className:"text-white/50 text-sm",children:"Détection clients inactifs & relances"})]}),e.jsxs("button",{onClick:()=>c(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl font-medium shadow-lg shadow-amber-500/30 hover:shadow-amber-500/50 transition-all",children:[e.jsx(X,{className:"w-5 h-5"}),"Nouvelle campagne"]})]}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[{label:"Clients inactifs",value:n?.total_clients_inactifs||i.length,icon:_,color:"from-red-500 to-rose-600"},{label:"VIP à réactiver",value:n?.vip_inactifs||i.filter(s=>s.segment==="vip").length,icon:k,color:"from-amber-500 to-orange-600"},{label:"CA potentiel",value:`${n?.ca_potentiel_euros||i.reduce((s,t)=>s+parseFloat(t.ca_total_euros),0).toFixed(0)}€`,icon:A,color:"from-green-500 to-emerald-600"},{label:"Taux réactivation",value:n?.taux_reactivation?`${n.taux_reactivation}%`:"—",icon:G,color:"from-purple-500 to-violet-600"}].map((s,t)=>e.jsxs("div",{className:"bg-zinc-900/80 border border-white/10 rounded-2xl p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-white/50 text-sm",children:s.label}),e.jsx("div",{className:`w-10 h-10 bg-gradient-to-br ${s.color} rounded-xl flex items-center justify-center shadow-lg`,children:e.jsx(s.icon,{className:"w-5 h-5 text-white"})})]}),e.jsx("p",{className:"text-2xl font-bold text-white",children:s.value})]},t))}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsx("div",{className:"flex gap-1 bg-zinc-900/50 p-1 rounded-xl",children:[{id:"clients",label:"Clients inactifs",icon:I},{id:"campagnes",label:"Campagnes",icon:h}].map(s=>e.jsxs("button",{onClick:()=>F(s.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${d===s.id?"bg-gradient-to-r from-amber-500 to-orange-500 text-white shadow-lg":"text-white/60 hover:text-white hover:bg-white/10"}`,children:[e.jsx(s.icon,{className:"w-4 h-4"}),s.label]},s.id))}),d==="clients"&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4 text-white/50"}),e.jsxs("select",{value:b,onChange:s=>D(parseInt(s.target.value)),className:"bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-white text-sm focus:border-amber-500 focus:outline-none",children:[e.jsx("option",{value:3,children:"Inactifs +3 mois"}),e.jsx("option",{value:6,children:"Inactifs +6 mois"}),e.jsx("option",{value:12,children:"Inactifs +12 mois"})]})]}),e.jsxs("select",{value:p,onChange:s=>M(s.target.value),className:"bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-white text-sm focus:border-amber-500 focus:outline-none",children:[e.jsx("option",{value:"all",children:"Tous segments"}),e.jsx("option",{value:"vip",children:"VIP uniquement"}),e.jsx("option",{value:"fidele",children:"Fidèles"}),e.jsx("option",{value:"standard",children:"Standard"})]})]})]}),T?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-amber-500"})}):e.jsxs(e.Fragment,{children:[d==="clients"&&e.jsx("div",{className:"space-y-4",children:C.length===0?e.jsxs("div",{className:"text-center py-12 bg-zinc-900/50 rounded-2xl border border-white/10",children:[e.jsx(I,{className:"w-12 h-12 text-white/20 mx-auto mb-4"}),e.jsx("h3",{className:"text-white font-semibold mb-2",children:"Aucun client inactif"}),e.jsx("p",{className:"text-white/50 text-sm",children:"Tous vos clients sont actifs, bravo !"})]}):C.map(s=>e.jsx("div",{className:"bg-zinc-900/80 border border-white/10 rounded-2xl p-5 hover:border-amber-500/30 transition-all",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("div",{className:"w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-600 rounded-full flex items-center justify-center text-white font-bold text-lg",children:[s.prenom?.[0],s.nom?.[0]]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-white font-semibold",children:[s.prenom," ",s.nom]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[V(s.segment),B(s.niveau_inactivite)]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/60",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsxs("span",{children:["Dernier RDV: ",new Date(s.dernier_rdv).toLocaleDateString("fr-FR")]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/60",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.mois_inactivite," mois d'inactivité"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/60",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.nb_rdv_total," RDV total"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-400",children:[e.jsx(A,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.ca_total_euros,"€ CA"]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 lg:items-end",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm mb-2",children:[e.jsx(z,{className:"w-4 h-4 text-amber-400"}),e.jsxs("span",{className:"text-amber-400 font-medium",children:["Offre suggérée: -",s.offre_suggeree,"%"]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.telephone&&e.jsxs("button",{onClick:()=>u(s),className:"flex items-center gap-2 px-4 py-2 bg-green-500/20 hover:bg-green-500/30 border border-green-500/30 text-green-400 rounded-xl text-sm transition-all",children:[e.jsx(R,{className:"w-4 h-4"}),"SMS"]}),s.email&&e.jsxs("button",{onClick:()=>u(s),className:"flex items-center gap-2 px-4 py-2 bg-blue-500/20 hover:bg-blue-500/30 border border-blue-500/30 text-blue-400 rounded-xl text-sm transition-all",children:[e.jsx(h,{className:"w-4 h-4"}),"Email"]}),e.jsxs("button",{onClick:()=>u(s),className:"flex items-center gap-2 px-4 py-2 bg-amber-500/20 hover:bg-amber-500/30 border border-amber-500/30 text-amber-400 rounded-xl text-sm transition-all",children:[e.jsx(W,{className:"w-4 h-4"}),"Relancer IA"]})]})]})]})},s.id))}),d==="campagnes"&&e.jsx("div",{className:"space-y-4",children:N.length===0?e.jsxs("div",{className:"text-center py-12 bg-zinc-900/50 rounded-2xl border border-white/10",children:[e.jsx(h,{className:"w-12 h-12 text-white/20 mx-auto mb-4"}),e.jsx("h3",{className:"text-white font-semibold mb-2",children:"Aucune campagne"}),e.jsx("p",{className:"text-white/50 text-sm mb-4",children:"Créez votre première campagne de relance"}),e.jsx("button",{className:"px-4 py-2 bg-amber-500 text-white rounded-xl font-medium",children:"Créer une campagne"})]}):N.map(s=>e.jsxs("div",{className:"bg-zinc-900/80 border border-white/10 rounded-2xl p-5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold",children:s.nom}),e.jsx("p",{className:"text-white/50 text-sm",children:s.type})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${s.statut==="active"?"bg-green-500/20 text-green-400":s.statut==="terminee"?"bg-purple-500/20 text-purple-400":"bg-white/10 text-white/60"}`,children:s.statut})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-white/5 rounded-xl",children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:s.clients_cibles}),e.jsx("p",{className:"text-xs text-white/50",children:"Ciblés"})]}),e.jsxs("div",{className:"text-center p-3 bg-white/5 rounded-xl",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-400",children:s.clients_contactes}),e.jsx("p",{className:"text-xs text-white/50",children:"Contactés"})]}),e.jsxs("div",{className:"text-center p-3 bg-white/5 rounded-xl",children:[e.jsx("p",{className:"text-2xl font-bold text-green-400",children:s.clients_convertis}),e.jsx("p",{className:"text-xs text-white/50",children:"Convertis"})]}),e.jsxs("div",{className:"text-center p-3 bg-white/5 rounded-xl",children:[e.jsxs("p",{className:"text-2xl font-bold text-amber-400",children:[s.taux_conversion,"%"]}),e.jsx("p",{className:"text-xs text-white/50",children:"Conversion"})]})]})]},s.id))})]})]}),L&&a&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-zinc-900 border border-white/10 rounded-2xl w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(j,{className:"w-5 h-5 text-amber-400"}),"Relancer ",a.prenom]}),e.jsx("button",{onClick:()=>{c(!1),m(null)},className:"text-white/50 hover:text-white",children:e.jsx(O,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(z,{className:"w-5 h-5 text-amber-400"}),e.jsx("span",{className:"text-amber-400 font-medium",children:"Offre suggérée par l'IA"})]}),e.jsxs("p",{className:"text-white text-2xl font-bold",children:["-",a.offre_suggeree,"%"]}),e.jsxs("p",{className:"text-white/60 text-sm mt-1",children:["Sur ",a.service_prefere]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-white/70 text-sm",children:"Choisissez le canal de relance :"}),a.telephone&&e.jsxs("button",{onClick:()=>y("sms"),disabled:x,className:"w-full flex items-center justify-between px-4 py-3 bg-green-500/10 hover:bg-green-500/20 border border-green-500/30 text-green-400 rounded-xl transition-all disabled:opacity-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(R,{className:"w-5 h-5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:"SMS"}),e.jsx("p",{className:"text-xs text-green-400/70",children:a.telephone})]})]}),x?e.jsx(S,{className:"w-5 h-5 animate-spin"}):e.jsx(j,{className:"w-5 h-5"})]}),a.email&&e.jsxs("button",{onClick:()=>y("email"),disabled:x,className:"w-full flex items-center justify-between px-4 py-3 bg-blue-500/10 hover:bg-blue-500/20 border border-blue-500/30 text-blue-400 rounded-xl transition-all disabled:opacity-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{className:"w-5 h-5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:"Email"}),e.jsx("p",{className:"text-xs text-blue-400/70",children:a.email})]})]}),x?e.jsx(S,{className:"w-5 h-5 animate-spin"}):e.jsx(j,{className:"w-5 h-5"})]})]})]}),e.jsx("div",{className:"p-4 border-t border-white/10",children:e.jsx("button",{onClick:()=>{c(!1),m(null)},className:"w-full px-4 py-3 border border-white/10 text-white/70 rounded-xl hover:bg-white/5 transition-all",children:"Annuler"})})]})})]})}export{Se as default};
