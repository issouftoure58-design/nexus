import{c as p,r as n,j as e,L as y,N as be,S as I,X as je}from"./index-_yXYEqcL.js";import{A as ge,M as fe,T as Ne}from"./AdminLayout-CTeGiCEF.js";import{F as J}from"./file-text-DGGLtmm2.js";import{C as H}from"./chart-column-eauyrf0D.js";import{P as z}from"./percent-B3SZmwXD.js";import{B as we}from"./building-2-vzz2bg68.js";import{P as ve}from"./phone-DqBiH1an.js";import{S as ye}from"./shield-DwVSybTP.js";import{C as _e}from"./car-DasvkYGK.js";import{C as Te}from"./credit-card-BzWzjUVE.js";import{G as Ce}from"./graduation-cap-C679OTK5.js";import{C as K}from"./circle-help-00cknjf3.js";import{T as ze,P as ke,a as Se}from"./PieChart-4B2ZOijp.js";import{R as Ae,C as Fe,T as $e,O as Ve}from"./generateCategoricalChart-DfuJ2MFb.js";import{P as De}from"./plus-D6ktc07k.js";import{P as Me}from"./pen-H50PqqQV.js";import{T as Re}from"./trash-2-CXbRkBbN.js";import{D as Ee}from"./dollar-sign-BiCuoXDd.js";import{S as Pe}from"./send-horizontal-BiFmYfSf.js";import{C as q}from"./circle-check-DHSvjqNQ.js";import{C as Le}from"./check-B1pij6wq.js";import{C as Ie}from"./circle-x-CE1ZE8zE.js";import{C as He}from"./clock-xh9IAeUk.js";import"./image-nfPd-l1I.js";import"./settings-BkyowQvs.js";import"./user-Ai5-1aUm.js";import"./calendar-NWhThMGY.js";import"./scissors-DPHsfmq1.js";import"./users-DLPfMp13.js";import"./shopping-bag-CEo4UOGG.js";import"./message-square-BHRNNhOm.js";import"./sparkles-BX8nnFHk.js";import"./chevron-right-DPdOXaL5.js";import"./log-out-CvuSphzZ.js";import"./index-BwpFS_hM.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=p("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=p("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=p("ChartPie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=p("Fuel",[["line",{x1:"3",x2:"15",y1:"22",y2:"22",key:"xegly4"}],["line",{x1:"4",x2:"14",y1:"9",y2:"9",key:"xcnuvu"}],["path",{d:"M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18",key:"16j0yd"}],["path",{d:"M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5",key:"7cu91f"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=p("Laptop",[["path",{d:"M20 16V7a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v9m16 0H4m16 0 1.28 2.55a1 1 0 0 1-.9 1.45H3.62a1 1 0 0 1-.9-1.45L4 16",key:"tarvll"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=p("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=p("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]),S=[{id:"fournitures",label:"Fournitures",icon:_},{id:"loyer",label:"Loyer",icon:we},{id:"charges",label:"Charges",icon:qe},{id:"telecom",label:"Télécom",icon:ve},{id:"assurance",label:"Assurance",icon:ye},{id:"transport",label:"Transport",icon:_e},{id:"marketing",label:"Marketing",icon:fe},{id:"bancaire",label:"Frais bancaires",icon:Te},{id:"formation",label:"Formation",icon:Ce},{id:"materiel",label:"Matériel",icon:U},{id:"logiciel",label:"Logiciel",icon:U},{id:"comptabilite",label:"Comptabilité",icon:J},{id:"taxes",label:"Taxes",icon:_},{id:"autre",label:"Autre",icon:K}],m={fournitures:"#f59e0b",loyer:"#ef4444",charges:"#f97316",telecom:"#3b82f6",assurance:"#8b5cf6",transport:"#10b981",marketing:"#ec4899",bancaire:"#6366f1",formation:"#14b8a6",materiel:"#f43f5e",logiciel:"#06b6d4",comptabilite:"#84cc16",taxes:"#dc2626",autre:"#6b7280"};function _t(){const[b,A]=n.useState("apercu"),[j,W]=n.useState([]),[g,X]=n.useState(null),[h,Y]=n.useState(null),[F,Z]=n.useState(null),[$,Q]=n.useState(null),[ee,V]=n.useState(!0),[te,N]=n.useState(!1),[i,w]=n.useState(null),[T,D]=n.useState(!1),[M,R]=n.useState(null),[E,P]=n.useState(!1),[x,se]=n.useState(()=>{const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`});n.useEffect(()=>{u()},[x]);const u=async()=>{V(!0);const a={Authorization:`Bearer ${localStorage.getItem("admin_token")}`};try{const[r,l,s,c,d]=await Promise.all([fetch(`/api/depenses?mois=${x}`,{headers:a}).then(o=>o.json()).catch(()=>({depenses:[]})),fetch(`/api/depenses/resume?mois=${x}`,{headers:a}).then(o=>o.json()).catch(()=>null),fetch(`/api/depenses/compte-resultat?mois=${x}`,{headers:a}).then(o=>o.json()).catch(()=>null),fetch(`/api/depenses/tva?mois=${x}`,{headers:a}).then(o=>o.json()).catch(()=>null),fetch(`/api/factures?mois=${x}`,{headers:a}).then(o=>o.json()).catch(()=>({factures:[],stats:{}}))]);W(r.depenses||[]),X(l),Y(s),Z(c),Q(d.success?d:null)}catch(r){console.error("Erreur chargement comptabilité:",r)}finally{V(!1)}},ae=async t=>{D(!0);const a=localStorage.getItem("admin_token");try{const r=i?.id?`/api/depenses/${i.id}`:"/api/depenses",l=i?.id?"PUT":"POST",s=Math.round(parseFloat(t.montant_ttc_input||"0")*100),c=parseFloat(t.taux_tva_input||"20"),d=t.deductible_tva_input==="true",o=c>0?Math.round(s/(1+c/100)):s;await fetch(r,{method:l,headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({...t,montant:o,montant_ttc:s,taux_tva:c,deductible_tva:d})}),N(!1),w(null),u()}catch(r){console.error("Erreur sauvegarde:",r)}finally{D(!1)}},re=async t=>{if(!confirm("Supprimer cette dépense ?"))return;const a=localStorage.getItem("admin_token");try{await fetch(`/api/depenses/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}}),u()}catch(r){console.error("Erreur suppression:",r)}},L=t=>{w(t||null),N(!0)},v=t=>{const a=S.find(r=>r.id===t);return a?a.icon:K},f=t=>{const a=S.find(r=>r.id===t);return a?a.label:t},C=g?.par_categorie.map(t=>({name:f(t.categorie),value:parseFloat(t.montant_euros),color:m[t.categorie]||"#6b7280"}))||[],le=()=>{const t=parseFloat(h?.compte_resultat.chiffre_affaires.total_euros||"0"),a=parseFloat(h?.compte_resultat.charges.total_euros||"0"),r=parseFloat(h?.compte_resultat.resultat_net.total_euros||"0"),l=parseFloat(h?.compte_resultat.resultat_net.marge_nette||"0"),s=h?.compte_resultat.resultat_net.positif??!0;return e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-600/20 to-green-800/20 border border-green-500/30 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-green-400"}),e.jsx("span",{className:"text-xs text-white/60",children:"Chiffre d'affaires"})]}),e.jsxs("p",{className:"text-2xl font-bold text-white",children:[t.toFixed(2),"€"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-red-600/20 to-red-800/20 border border-red-500/30 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ze,{className:"w-5 h-5 text-red-400"}),e.jsx("span",{className:"text-xs text-white/60",children:"Total charges"})]}),e.jsxs("p",{className:"text-2xl font-bold text-white",children:[a.toFixed(2),"€"]})]}),e.jsxs("div",{className:`bg-gradient-to-br ${s?"from-blue-600/20 to-blue-800/20 border-blue-500/30":"from-orange-600/20 to-orange-800/20 border-orange-500/30"} border rounded-2xl p-4`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(k,{className:`w-5 h-5 ${s?"text-blue-400":"text-orange-400"}`}),e.jsx("span",{className:"text-xs text-white/60",children:"Résultat net"})]}),e.jsxs("p",{className:`text-2xl font-bold ${s?"text-white":"text-orange-400"}`,children:[s?"+":"",r.toFixed(2),"€"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-600/20 to-purple-800/20 border border-purple-500/30 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(z,{className:"w-5 h-5 text-purple-400"}),e.jsx("span",{className:"text-xs text-white/60",children:"Marge nette"})]}),e.jsxs("p",{className:`text-2xl font-bold ${l>=0?"text-white":"text-orange-400"}`,children:[l,"%"]})]})]})},ne=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-zinc-900/50 border border-white/10 rounded-2xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-amber-400"}),"Répartition des charges"]}),C.length>0?e.jsx(Ae,{width:"100%",height:300,children:e.jsxs(ke,{children:[e.jsx(Se,{data:C,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:2,dataKey:"value",children:C.map((t,a)=>e.jsx(Fe,{fill:t.color},`cell-${a}`))}),e.jsx($e,{formatter:t=>`${t.toFixed(2)}€`,contentStyle:{backgroundColor:"#27272a",border:"1px solid #3f3f46",borderRadius:"12px"}}),e.jsx(Ve,{})]})}):e.jsx("div",{className:"h-[300px] flex items-center justify-center text-white/40",children:"Aucune dépense ce mois"})]}),e.jsxs("div",{className:"bg-zinc-900/50 border border-white/10 rounded-2xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-amber-400"}),"Top catégories"]}),e.jsxs("div",{className:"space-y-3",children:[g?.par_categorie.slice(0,6).map(t=>{const a=v(t.categorie);return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{backgroundColor:`${m[t.categorie]}20`},children:e.jsx(a,{size:18,style:{color:m[t.categorie]}})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-white text-sm",children:f(t.categorie)}),e.jsxs("span",{className:"text-white font-medium",children:[t.montant_euros,"€"]})]}),e.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${t.pourcentage}%`,backgroundColor:m[t.categorie]}})})]})]},t.categorie)}),(!g?.par_categorie||g.par_categorie.length===0)&&e.jsx("div",{className:"text-center text-white/40 py-8",children:"Aucune dépense ce mois"})]})]})]}),e.jsxs("div",{className:"bg-zinc-900/50 border border-white/10 rounded-2xl p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-amber-400"}),"Dernières dépenses"]}),e.jsx("button",{onClick:()=>A("depenses"),className:"text-sm text-amber-400 hover:text-amber-300 transition",children:"Voir tout →"})]}),e.jsxs("div",{className:"space-y-2",children:[j.slice(0,5).map(t=>{const a=v(t.categorie);return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{backgroundColor:`${m[t.categorie]}20`},children:e.jsx(a,{size:18,style:{color:m[t.categorie]}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white text-sm",children:t.libelle||t.description}),e.jsx("p",{className:"text-white/40 text-xs",children:f(t.categorie)})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-white font-medium",children:[t.montant_ttc_euros||t.montant_euros,"€"]}),e.jsxs("p",{className:"text-amber-400/60 text-xs",children:["TVA: ",t.montant_tva_euros||"0.00","€"]})]})]},t.id)}),j.length===0&&e.jsx("div",{className:"text-center text-white/40 py-8",children:"Aucune dépense ce mois"})]})]})]}),ie=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-bold text-white",children:["Dépenses (",j.length,")"]}),e.jsxs("button",{onClick:()=>L(),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl hover:shadow-lg hover:shadow-amber-500/30 transition-all",children:[e.jsx(De,{size:18}),"Nouvelle dépense"]})]}),e.jsxs("div",{className:"bg-zinc-900/50 border border-white/10 rounded-2xl overflow-hidden",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-white/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4 text-white/60 font-medium",children:"Description"}),e.jsx("th",{className:"text-left p-4 text-white/60 font-medium",children:"Catégorie"}),e.jsx("th",{className:"text-left p-4 text-white/60 font-medium",children:"Date"}),e.jsx("th",{className:"text-right p-4 text-white/60 font-medium",children:"TTC"}),e.jsx("th",{className:"text-right p-4 text-white/60 font-medium",children:"TVA"}),e.jsx("th",{className:"text-right p-4 text-white/60 font-medium",children:"HT"}),e.jsx("th",{className:"text-right p-4 text-white/60 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:j.map(t=>{const a=v(t.categorie);return e.jsxs("tr",{className:"border-t border-white/5",children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{children:[e.jsx("span",{className:"text-white",children:t.libelle||t.description}),t.recurrence&&t.recurrence!=="ponctuelle"&&e.jsx("span",{className:`ml-2 px-2 py-0.5 text-xs rounded-full ${t.recurrence==="mensuelle"?"bg-blue-500/20 text-blue-400":t.recurrence==="trimestrielle"?"bg-purple-500/20 text-purple-400":"bg-green-500/20 text-green-400"}`,children:t.recurrence})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(a,{size:16,style:{color:m[t.categorie]}}),e.jsx("span",{className:"text-white/80",children:f(t.categorie)})]})}),e.jsx("td",{className:"p-4 text-white/60",children:new Date(t.date_depense).toLocaleDateString("fr-FR")}),e.jsxs("td",{className:"p-4 text-right text-white font-medium",children:[t.montant_ttc_euros||t.montant_euros,"€"]}),e.jsxs("td",{className:"p-4 text-right",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-amber-400",children:[t.montant_tva_euros||"0.00","€"]}),e.jsxs("span",{className:"text-white/40 text-xs ml-1",children:["(",t.taux_tva||0,"%)"]})]}),!t.deductible_tva&&e.jsx("span",{className:"text-xs text-red-400/80",children:"Non déductible"})]}),e.jsxs("td",{className:"p-4 text-right text-white/80",children:[t.montant_euros,"€"]}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx("button",{onClick:()=>L(t),className:"p-1.5 hover:bg-white/10 rounded-lg transition text-white/60 hover:text-amber-400",children:e.jsx(Me,{size:16})}),e.jsx("button",{onClick:()=>re(t.id),className:"p-1.5 hover:bg-white/10 rounded-lg transition text-white/60 hover:text-red-400",children:e.jsx(Re,{size:16})})]})})]},t.id)})})]}),j.length===0&&e.jsx("div",{className:"text-center text-white/40 py-12",children:"Aucune dépense ce mois"})]}),j.length>0&&e.jsxs("div",{className:"bg-zinc-900/50 border border-white/10 rounded-2xl p-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-white/60",children:"Total des dépenses"}),e.jsxs("span",{className:"text-2xl font-bold text-white",children:[g?.total_euros||"0","€"]})]})]}),ce=()=>{const t=h?.compte_resultat;if(!t)return e.jsxs("div",{className:"bg-zinc-900/50 border border-white/10 rounded-2xl p-12 text-center",children:[e.jsx(Ee,{className:"w-12 h-12 mx-auto mb-4 text-white/30"}),e.jsx("p",{className:"text-white/60",children:"Données insuffisantes pour le compte de résultat"})]});const a=parseFloat(t.chiffre_affaires.total_euros),r=parseFloat(t.charges.total_euros),l=parseFloat(t.resultat_net.total_euros),s=t.resultat_net.positif;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-zinc-900/50 border border-white/10 rounded-2xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-6",children:["Compte de résultat - ",h?.mois]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-green-500/10 border border-green-500/20 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"w-6 h-6 text-green-400"}),e.jsx("span",{className:"text-white font-medium",children:"Chiffre d'affaires"})]}),e.jsxs("span",{className:"text-2xl font-bold text-green-400",children:["+",a.toFixed(2),"€"]})]}),e.jsxs("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{className:"w-6 h-6 text-red-400"}),e.jsx("span",{className:"text-white font-medium",children:"Charges"})]}),e.jsxs("span",{className:"text-2xl font-bold text-red-400",children:["-",r.toFixed(2),"€"]})]}),e.jsx("div",{className:"space-y-2 ml-9",children:t.charges.detail.map(c=>{const d=v(c.categorie);return e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2 text-white/60",children:[e.jsx(d,{size:14,style:{color:m[c.categorie]}}),f(c.categorie)]}),e.jsxs("span",{className:"text-white/80",children:[c.montant_euros,"€"]})]},c.categorie)})})]}),e.jsx("div",{className:"border-t border-white/20 my-2"}),e.jsxs("div",{className:`flex items-center justify-between p-4 rounded-xl ${s?"bg-blue-500/10 border border-blue-500/20":"bg-orange-500/10 border border-orange-500/20"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{className:`w-6 h-6 ${s?"text-blue-400":"text-orange-400"}`}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white font-medium",children:"Résultat net"}),e.jsxs("p",{className:"text-xs text-white/40",children:["Marge: ",t.resultat_net.marge_nette,"%"]})]})]}),e.jsxs("span",{className:`text-3xl font-bold ${s?"text-blue-400":"text-orange-400"}`,children:[s?"+":"",l.toFixed(2),"€"]})]})]})]}),e.jsx("div",{className:`p-4 rounded-xl ${s?"bg-green-500/10 border border-green-500/30":"bg-yellow-500/10 border border-yellow-500/30"}`,children:e.jsx("p",{className:`${s?"text-green-400":"text-yellow-400"}`,children:s?`Excellent ! Votre activité est rentable ce mois avec une marge nette de ${t.resultat_net.marge_nette}%.`:"Attention : vos charges dépassent vos revenus ce mois. Analysez vos dépenses pour identifier les postes à optimiser."})})]})},oe=()=>{const t=F?.tva;if(!t)return e.jsxs("div",{className:"bg-zinc-900/50 border border-white/10 rounded-2xl p-12 text-center",children:[e.jsx(z,{className:"w-12 h-12 mx-auto mb-4 text-white/30"}),e.jsx("p",{className:"text-white/60",children:"Données TVA indisponibles"})]});const a=parseFloat(t.collectee.tva_euros),r=parseFloat(t.deductible.tva_euros),l=parseFloat(t.solde.montant_euros);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-zinc-900/50 border border-white/10 rounded-2xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-6",children:["Déclaration TVA - ",F?.mois]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-green-500/10 border border-green-500/20 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"w-6 h-6 text-green-400"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white font-medium",children:"TVA Collectée"}),e.jsxs("p",{className:"text-xs text-white/40",children:["Sur ventes (",t.collectee.nb_operations," opérations)"]})]})]}),e.jsxs("span",{className:"text-2xl font-bold text-green-400",children:[a.toFixed(2),"€"]})]}),e.jsxs("div",{className:"ml-9 text-sm text-white/60",children:["Base HT: ",t.collectee.base_ht_euros,"€"]}),t.collectee.detail_par_taux&&t.collectee.detail_par_taux.length>0&&e.jsx("div",{className:"ml-9 mt-2 space-y-1",children:t.collectee.detail_par_taux.map(s=>e.jsxs("div",{className:"flex justify-between text-xs text-white/50",children:[e.jsxs("span",{children:["Taux ",s.taux,"% (",s.nb_operations," ventes)"]}),e.jsxs("span",{children:[s.tva_euros,"€ (sur ",s.base_ht_euros,"€ HT)"]})]},s.taux))})]}),e.jsxs("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{className:"w-6 h-6 text-red-400"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white font-medium",children:"TVA Déductible"}),e.jsxs("p",{className:"text-xs text-white/40",children:["Sur achats (",t.deductible.nb_operations," opérations)"]})]})]}),e.jsxs("span",{className:"text-2xl font-bold text-red-400",children:["-",r.toFixed(2),"€"]})]}),e.jsxs("div",{className:"ml-9 text-sm text-white/60",children:["Base HT: ",t.deductible.base_ht_euros,"€"]}),t.deductible.detail_par_taux.length>0&&e.jsx("div",{className:"ml-9 mt-2 space-y-1",children:t.deductible.detail_par_taux.map(s=>e.jsxs("div",{className:"flex justify-between text-xs text-white/50",children:[e.jsxs("span",{children:["Taux ",s.taux,"%"]}),e.jsxs("span",{children:[s.tva_euros,"€ (sur ",s.base_ht_euros,"€ HT)"]})]},s.taux))})]}),e.jsx("div",{className:"border-t border-white/20 my-2"}),e.jsx("div",{className:`p-4 rounded-xl ${t.solde.a_payer?"bg-amber-500/10 border border-amber-500/20":"bg-blue-500/10 border border-blue-500/20"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{className:`w-6 h-6 ${t.solde.a_payer?"text-amber-400":"text-blue-400"}`}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white font-medium",children:t.solde.a_payer?"TVA à payer":"Crédit de TVA"}),e.jsx("p",{className:"text-xs text-white/40",children:t.solde.a_payer?"À reverser à l'État":"Reportable sur période suivante"})]})]}),e.jsxs("span",{className:`text-3xl font-bold ${t.solde.a_payer?"text-amber-400":"text-blue-400"}`,children:[Math.abs(l).toFixed(2),"€"]})]})})]})]}),e.jsx("div",{className:`p-4 rounded-xl ${t.solde.a_payer?"bg-amber-500/10 border border-amber-500/30":"bg-blue-500/10 border border-blue-500/30"}`,children:e.jsx("p",{className:t.solde.a_payer?"text-amber-300":"text-blue-300",children:t.solde.a_payer?`Vous devez reverser ${Math.abs(l).toFixed(2)}€ de TVA à l'État pour ce mois.`:l===0?"Votre TVA collectée et déductible s'équilibrent ce mois.":`Vous avez un crédit de TVA de ${Math.abs(l).toFixed(2)}€ reportable.`})}),e.jsx("div",{className:"bg-zinc-900/50 border border-white/10 rounded-2xl p-4",children:e.jsxs("p",{className:"text-white/50 text-sm",children:[e.jsx("strong",{className:"text-white/70",children:"Rappel :"}),' La TVA collectée est calculée sur vos prestations de services (taux de 20%). La TVA déductible correspond à la TVA sur vos achats professionnels (uniquement sur les dépenses marquées "TVA déductible").']})})]})},de=async t=>{R(t);const a=localStorage.getItem("admin_token");try{const l=await(await fetch(`/api/factures/${t}/envoyer`,{method:"POST",headers:{Authorization:`Bearer ${a}`}})).json();l.success?u():alert(l.error||"Erreur envoi")}catch(r){console.error("Erreur envoi facture:",r)}finally{R(null)}},xe=async()=>{if(!confirm("Envoyer toutes les factures en attente par email ?"))return;P(!0);const t=localStorage.getItem("admin_token");try{const r=await(await fetch("/api/factures/envoyer-toutes",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({mois:x})})).json();r.success?(alert(`${r.nb_envoyees} facture(s) envoyée(s)`),u()):alert(r.error||"Erreur envoi")}catch(a){console.error("Erreur envoi factures:",a)}finally{P(!1)}},me=async()=>{const t=localStorage.getItem("admin_token");try{const r=await(await fetch("/api/factures/generer-manquantes",{method:"POST",headers:{Authorization:`Bearer ${t}`}})).json();r.success&&(alert(`${r.nb_creees} facture(s) générée(s)`),u())}catch(a){console.error("Erreur génération:",a)}},he=async(t,a)=>{const r=localStorage.getItem("admin_token");try{await fetch(`/api/factures/${t}/statut`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({statut:a})}),u()}catch(l){console.error("Erreur changement statut:",l)}},ue=()=>{const t=$?.factures||[],a=$?.stats,r=s=>{switch(s){case"generee":return e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 text-xs bg-amber-500/20 text-amber-400 rounded-full",children:[e.jsx(He,{size:12}),"En attente"]});case"envoyee":return e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 text-xs bg-blue-500/20 text-blue-400 rounded-full",children:[e.jsx(I,{size:12}),"Envoyée"]});case"payee":return e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 text-xs bg-green-500/20 text-green-400 rounded-full",children:[e.jsx(q,{size:12}),"Payée"]});case"annulee":return e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 text-xs bg-red-500/20 text-red-400 rounded-full",children:[e.jsx(Ie,{size:12}),"Annulée"]});default:return null}},l=s=>{if(!s||s===0)return null;const d={1:{label:"1",color:"bg-blue-500/30 text-blue-300 border-blue-500/50"},2:{label:"2",color:"bg-orange-500/30 text-orange-300 border-orange-500/50"},3:{label:"3",color:"bg-red-500/30 text-red-300 border-red-500/50"},4:{label:"4",color:"bg-purple-500/30 text-purple-300 border-purple-500/50"}}[s];return d?e.jsx("span",{className:`inline-flex items-center justify-center w-6 h-6 text-xs font-bold rounded-full border ${d.color}`,children:d.label}):null};return e.jsxs("div",{className:"space-y-6",children:[a&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-zinc-900/50 border border-white/10 rounded-2xl p-4",children:[e.jsx("p",{className:"text-white/60 text-sm",children:"Total factures"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:a.total})]}),e.jsxs("div",{className:"bg-zinc-900/50 border border-white/10 rounded-2xl p-4",children:[e.jsx("p",{className:"text-white/60 text-sm",children:"Montant TTC"}),e.jsxs("p",{className:"text-2xl font-bold text-green-400",children:[a.total_ttc_euros,"€"]})]}),e.jsxs("div",{className:"bg-zinc-900/50 border border-white/10 rounded-2xl p-4",children:[e.jsx("p",{className:"text-white/60 text-sm",children:"En attente d'envoi"}),e.jsx("p",{className:"text-2xl font-bold text-amber-400",children:a.nb_en_attente})]}),e.jsxs("div",{className:"bg-zinc-900/50 border border-white/10 rounded-2xl p-4",children:[e.jsx("p",{className:"text-white/60 text-sm",children:"Envoyées"}),e.jsx("p",{className:"text-2xl font-bold text-blue-400",children:a.nb_envoyees})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:xe,disabled:E||!a?.nb_en_attente,className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl hover:shadow-lg hover:shadow-amber-500/30 transition-all disabled:opacity-50",children:[E?e.jsx(y,{size:18,className:"animate-spin"}):e.jsx(Pe,{size:18}),"Envoyer toutes (",a?.nb_en_attente||0,")"]}),e.jsxs("button",{onClick:me,className:"flex items-center gap-2 px-4 py-2 bg-zinc-800 text-white/80 rounded-xl hover:bg-zinc-700 transition",children:[e.jsx(be,{size:18}),"Générer manquantes"]})]}),e.jsxs("div",{className:"bg-zinc-900/50 border border-white/10 rounded-2xl overflow-hidden",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-white/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4 text-white/60 font-medium",children:"N° Facture"}),e.jsx("th",{className:"text-left p-4 text-white/60 font-medium",children:"Client"}),e.jsx("th",{className:"text-left p-4 text-white/60 font-medium",children:"Service"}),e.jsx("th",{className:"text-left p-4 text-white/60 font-medium",children:"Date"}),e.jsx("th",{className:"text-right p-4 text-white/60 font-medium",children:"TTC"}),e.jsx("th",{className:"text-center p-4 text-white/60 font-medium",children:"Statut"}),e.jsx("th",{className:"text-center p-4 text-white/60 font-medium",children:"Relance"}),e.jsx("th",{className:"text-right p-4 text-white/60 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:t.map(s=>e.jsxs("tr",{className:"border-t border-white/5",children:[e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"text-white font-mono text-sm",children:s.numero})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-white",children:s.client_nom}),s.client_email&&e.jsx("p",{className:"text-white/40 text-xs",children:s.client_email})]})}),e.jsx("td",{className:"p-4 text-white/80",children:s.service_nom}),e.jsx("td",{className:"p-4 text-white/60",children:new Date(s.date_prestation).toLocaleDateString("fr-FR")}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-white font-medium",children:[s.montant_ttc_euros,"€"]}),e.jsxs("p",{className:"text-white/40 text-xs",children:["TVA: ",s.montant_tva_euros,"€"]})]})}),e.jsx("td",{className:"p-4 text-center",children:r(s.statut)}),e.jsx("td",{className:"p-4 text-center",children:l(s.niveau_relance)}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex justify-end gap-1",children:[s.statut==="generee"&&s.client_email&&e.jsxs("button",{onClick:()=>de(s.id),disabled:M===s.id,className:"flex items-center gap-1 px-3 py-1.5 bg-amber-500/20 text-amber-400 rounded-lg hover:bg-amber-500/30 transition text-sm disabled:opacity-50",children:[M===s.id?e.jsx(y,{size:14,className:"animate-spin"}):e.jsx(I,{size:14}),"Envoyer"]}),s.statut==="envoyee"&&e.jsxs("button",{onClick:()=>he(s.id,"payee"),className:"flex items-center gap-1 px-3 py-1.5 bg-green-500/20 text-green-400 rounded-lg hover:bg-green-500/30 transition text-sm",children:[e.jsx(q,{size:14}),"Marquer payée"]}),!s.client_email&&s.statut==="generee"&&e.jsx("span",{className:"text-xs text-red-400/80 px-2 py-1",children:"Pas d'email"})]})})]},s.id))})]}),t.length===0&&e.jsx("div",{className:"text-center text-white/40 py-12",children:"Aucune facture ce mois"})]}),e.jsx("div",{className:"bg-zinc-900/50 border border-white/10 rounded-2xl p-4",children:e.jsxs("p",{className:"text-white/50 text-sm",children:[e.jsx("strong",{className:"text-white/70",children:"Info :"}),` Les factures sont générées automatiquement lorsqu'une réservation passe au statut "Terminé". Vous pouvez ensuite les envoyer par email au client (PDF joint).`]})})]})},pe=()=>te?e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-zinc-900 border border-white/10 rounded-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-white/10 flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:i?"Modifier la dépense":"Nouvelle dépense"}),e.jsx("button",{onClick:()=>{N(!1),w(null)},className:"p-2 hover:bg-white/10 rounded-lg transition",children:e.jsx(je,{size:20,className:"text-white/60"})})]}),e.jsxs("form",{onSubmit:t=>{t.preventDefault();const a=new FormData(t.currentTarget),r=Object.fromEntries(a.entries());a.has("deductible_tva_input")||(r.deductible_tva_input="false"),ae(r)},className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/60 mb-1",children:"Description *"}),e.jsx("input",{type:"text",name:"description",defaultValue:i?.description,required:!0,placeholder:"Ex: Achat produits coiffure",className:"w-full px-3 py-2 bg-zinc-800 border border-white/10 rounded-xl text-white"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/60 mb-1",children:"Montant TTC (€) *"}),e.jsx("input",{type:"number",name:"montant_ttc_input",defaultValue:i?.montant_ttc?(i.montant_ttc/100).toFixed(2):void 0,required:!0,step:"0.01",min:"0",placeholder:"0.00",className:"w-full px-3 py-2 bg-zinc-800 border border-white/10 rounded-xl text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/60 mb-1",children:"Taux TVA *"}),e.jsxs("select",{name:"taux_tva_input",defaultValue:i?.taux_tva?.toString()||"20",className:"w-full px-3 py-2 bg-zinc-800 border border-white/10 rounded-xl text-white",children:[e.jsx("option",{value:"20",children:"20% (Taux normal)"}),e.jsx("option",{value:"10",children:"10% (Taux intermédiaire)"}),e.jsx("option",{value:"5.5",children:"5.5% (Taux réduit)"}),e.jsx("option",{value:"2.1",children:"2.1% (Taux super-réduit)"}),e.jsx("option",{value:"0",children:"0% (Exonéré)"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/60 mb-1",children:"Date *"}),e.jsx("input",{type:"date",name:"date_depense",defaultValue:i?.date_depense||new Date().toISOString().split("T")[0],required:!0,className:"w-full px-3 py-2 bg-zinc-800 border border-white/10 rounded-xl text-white"})]}),e.jsx("div",{className:"flex items-center pt-6",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",name:"deductible_tva_input",value:"true",defaultChecked:i?.deductible_tva!==!1,className:"w-5 h-5 rounded bg-zinc-800 border border-white/10 text-amber-500 focus:ring-amber-500"}),e.jsx("span",{className:"text-white/80 text-sm",children:"TVA déductible"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/60 mb-1",children:"Catégorie *"}),e.jsx("select",{name:"categorie",defaultValue:i?.categorie||"autre",required:!0,className:"w-full px-3 py-2 bg-zinc-800 border border-white/10 rounded-xl text-white",children:S.map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/60 mb-1",children:"Récurrence"}),e.jsxs("select",{name:"recurrence",defaultValue:i?.recurrence||"ponctuelle",className:"w-full px-3 py-2 bg-zinc-800 border border-white/10 rounded-xl text-white",children:[e.jsx("option",{value:"ponctuelle",children:"Ponctuelle"}),e.jsx("option",{value:"mensuelle",children:"Mensuelle"}),e.jsx("option",{value:"trimestrielle",children:"Trimestrielle"}),e.jsx("option",{value:"annuelle",children:"Annuelle"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/60 mb-1",children:"Notes"}),e.jsx("textarea",{name:"notes",defaultValue:i?.notes,rows:2,placeholder:"Notes additionnelles...",className:"w-full px-3 py-2 bg-zinc-800 border border-white/10 rounded-xl text-white resize-none"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{N(!1),w(null)},className:"px-4 py-2 bg-white/10 text-white rounded-xl hover:bg-white/20 transition",children:"Annuler"}),e.jsxs("button",{type:"submit",disabled:T,className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl hover:shadow-lg hover:shadow-amber-500/30 transition-all disabled:opacity-50",children:[T?e.jsx(y,{size:18,className:"animate-spin"}):e.jsx(Le,{size:18}),T?"Enregistrement...":"Enregistrer"]})]})]})]})}):null;return e.jsx(ge,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-500",children:"Comptabilité"}),e.jsx("p",{className:"text-white/60 mt-1",children:"Suivi des dépenses et compte de résultat"})]}),e.jsx("input",{type:"month",value:x,onChange:t=>se(t.target.value),className:"px-3 py-2 bg-zinc-800 border border-white/10 rounded-xl text-white"})]}),le(),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[{id:"apercu",label:"Aperçu",icon:G},{id:"depenses",label:"Dépenses",icon:_},{id:"facturation",label:"Facturation",icon:J},{id:"resultat",label:"Compte de résultat",icon:H},{id:"tva",label:"TVA",icon:z}].map(t=>e.jsxs("button",{onClick:()=>A(t.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl transition-all whitespace-nowrap ${b===t.id?"bg-gradient-to-r from-amber-500 to-orange-500 text-white shadow-lg shadow-amber-500/30":"bg-zinc-800/50 text-white/60 hover:bg-zinc-800 hover:text-white"}`,children:[e.jsx(t.icon,{size:18}),t.label]},t.id))}),ee?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(y,{className:"w-8 h-8 animate-spin text-amber-400"})}):e.jsxs(e.Fragment,{children:[b==="apercu"&&ne(),b==="depenses"&&ie(),b==="facturation"&&ue(),b==="resultat"&&ce(),b==="tva"&&oe()]}),pe()]})})}export{_t as default};
