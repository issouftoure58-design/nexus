import{r,j as e}from"./index-_yXYEqcL.js";import{N as R}from"./NexusLayout-CwIbQ1JF.js";import"./hexagon-DZpsxAWV.js";import"./panel-left-close-C4ECLCua.js";import"./settings-BkyowQvs.js";import"./users-DLPfMp13.js";import"./credit-card-BzWzjUVE.js";import"./shield-DwVSybTP.js";import"./chevron-right-DPdOXaL5.js";import"./chart-column-eauyrf0D.js";import"./activity-ZIepOcem.js";import"./dollar-sign-BiCuoXDd.js";import"./brain-C9qc7Lcl.js";import"./log-out-CvuSphzZ.js";const v={starter:99,pro:199,business:399},y={starter:{bar:"bg-cyan-500",text:"text-cyan-400",bg:"bg-cyan-950/30 border-cyan-800"},pro:{bar:"bg-blue-500",text:"text-blue-400",bg:"bg-blue-950/30 border-blue-800"},business:{bar:"bg-purple-500",text:"text-purple-400",bg:"bg-purple-950/30 border-purple-800"}};function _(){const[a,l]=r.useState([]),[o,d]=r.useState(!0),[x,m]=r.useState(null),[j,f]=r.useState(0);r.useEffect(()=>{const t=async()=>{try{const i=localStorage.getItem("admin_token"),c=await fetch("/api/nexus/tenants",{headers:{Authorization:`Bearer ${i}`}});if(!c.ok)throw new Error("Erreur API");const N=await c.json();l(N.tenants||[])}catch{m("Erreur chargement des données")}finally{d(!1)}};t();const s=setInterval(t,3e4);return()=>clearInterval(s)},[]),r.useEffect(()=>{const t=setInterval(()=>f(s=>s+1),2e3);return()=>clearInterval(t)},[]);const n=a.reduce((t,s)=>t+(v[s.plan]||0),0),u=n*12,p=a.reduce((t,s)=>t+s.usage.cost,0),h=n>0?(n-p)/n*100:0,b=a.reduce((t,s)=>(t[s.plan]=(t[s.plan]||0)+1,t),{});return e.jsx(R,{children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-white",children:"Revenus & Facturation"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full bg-green-400 ${j%2===0?"opacity-100":"opacity-60"} transition-opacity`}),e.jsx("span",{className:"text-[10px] text-slate-500 font-mono",children:"Auto-refresh 30s"})]})]}),o&&e.jsx("div",{className:"grid grid-cols-4 gap-4",children:[1,2,3,4].map(t=>e.jsx("div",{className:"h-24 bg-slate-900 rounded-lg animate-pulse"},t))}),x&&e.jsx("div",{className:"text-red-400",children:x}),!o&&!x&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 mb-6",children:[e.jsx(g,{title:"MRR",value:n,suffix:"€",color:"cyan"}),e.jsx(g,{title:"ARR",value:u,suffix:"€",color:"blue"}),e.jsx(g,{title:"Couts variables",value:p,suffix:"€",color:"purple",decimals:2}),e.jsx(g,{title:"Marge",value:h,suffix:"%",color:h>70?"green":"red",decimals:0})]}),e.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 mb-6 p-4",children:[e.jsx("h2",{className:"font-semibold text-white mb-4",children:"Revenus par plan"}),e.jsx("div",{className:"space-y-4",children:["starter","pro","business"].map(t=>{const s=b[t]||0,i=a.length||1,c=s/i*100,N=s*(v[t]||0),w=y[t];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm font-medium ${w.text} capitalize`,children:t}),e.jsxs("span",{className:"text-xs text-slate-600",children:[s," tenant",s>1?"s":""]})]}),e.jsxs("span",{className:"text-sm text-white font-bold font-mono",children:[N,"€",e.jsx("span",{className:"text-slate-500 text-xs",children:"/mois"})]})]}),e.jsx("div",{className:"h-3 bg-slate-800 rounded-full overflow-hidden",children:e.jsx($,{pct:c,className:w.bar})})]},t)})}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-slate-800 flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Total MRR"}),e.jsxs("span",{className:"text-lg font-bold text-white font-mono",children:[n,"€"]})]})]}),e.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 overflow-x-auto",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-slate-800 flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold text-white",children:"Detail par tenant"}),e.jsxs("span",{className:"text-xs text-slate-500",children:[a.length," tenant",a.length>1?"s":""]})]}),e.jsxs("table",{className:"w-full min-w-[500px]",children:[e.jsx("thead",{className:"bg-slate-800/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm text-slate-400",children:"Tenant"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-slate-400",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm text-slate-400",children:"Prix"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm text-slate-400",children:"Cout"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm text-slate-400",children:"Marge"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm text-slate-400",children:"Health"})]})}),e.jsxs("tbody",{children:[a.map(t=>{const s=v[t.plan]||0,i=s>0?(s-t.usage.cost)/s*100:0,c=y[t.plan]||y.starter;return e.jsxs("tr",{className:"border-t border-slate-800 hover:bg-slate-800/30 transition group",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-medium text-white",children:t.name}),e.jsx("div",{className:"text-xs text-slate-500",children:t.id})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs border ${c.bg} ${c.text} capitalize`,children:t.plan})}),e.jsxs("td",{className:"px-4 py-3 text-right text-slate-300 font-mono",children:[s,"€"]}),e.jsxs("td",{className:"px-4 py-3 text-right text-slate-300 font-mono",children:[t.usage.cost.toFixed(2),"€"]}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("span",{className:`font-mono ${i>70?"text-green-400":i>40?"text-yellow-400":"text-red-400"}`,children:[i.toFixed(0),"%"]})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("div",{className:`w-2 h-2 rounded-full inline-block ${t.quota.status==="ok"?"bg-green-500":t.quota.status==="warning"?"bg-yellow-500":"bg-red-500"}`})})]},t.id)}),a.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-slate-500",children:"Aucun tenant"})})]})]})]})]})]})})}function g({title:a,value:l,suffix:o="",color:d,decimals:x=0}){const[m,j]=r.useState(0);r.useEffect(()=>{let u=0;const p=1e3,h=Date.now(),b=setInterval(()=>{const t=Math.min((Date.now()-h)/p,1),s=1-Math.pow(1-t,3);j(u+(l-u)*s),t>=1&&clearInterval(b)},16);return()=>clearInterval(b)},[l]);const f={cyan:"border-cyan-800 bg-cyan-950/30",blue:"border-blue-800 bg-blue-950/30",purple:"border-purple-800 bg-purple-950/30",green:"border-green-800 bg-green-950/30",red:"border-red-800 bg-red-950/30"},n={cyan:"text-cyan-400",blue:"text-blue-400",purple:"text-purple-400",green:"text-green-400",red:"text-red-400"};return e.jsxs("div",{className:`p-4 rounded-lg border ${f[d]} hover:brightness-110 transition`,children:[e.jsx("div",{className:"text-sm text-slate-400",children:a}),e.jsxs("div",{className:`text-2xl font-bold ${n[d]} tabular-nums font-mono`,children:[x>0?m.toFixed(x):Math.round(m).toLocaleString("fr-FR"),o]})]})}function $({pct:a,className:l}){const[o,d]=r.useState(0);return r.useEffect(()=>{setTimeout(()=>d(a),100)},[a]),e.jsx("div",{className:`h-full rounded-full ${l} transition-all duration-1000 ease-out relative`,style:{width:`${Math.max(o,2)}%`},children:e.jsx("div",{className:`absolute inset-0 rounded-full ${l} animate-pulse opacity-30`})})}export{_ as default};
