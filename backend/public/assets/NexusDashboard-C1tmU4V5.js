import{r as a,j as e}from"./index-_yXYEqcL.js";import{N as E}from"./NexusLayout-CwIbQ1JF.js";import"./hexagon-DZpsxAWV.js";import"./panel-left-close-C4ECLCua.js";import"./settings-BkyowQvs.js";import"./users-DLPfMp13.js";import"./credit-card-BzWzjUVE.js";import"./shield-DwVSybTP.js";import"./chevron-right-DPdOXaL5.js";import"./chart-column-eauyrf0D.js";import"./activity-ZIepOcem.js";import"./dollar-sign-BiCuoXDd.js";import"./brain-C9qc7Lcl.js";import"./log-out-CvuSphzZ.js";function G(){const[t,n]=a.useState(null),[s,r]=a.useState(null),[l,o]=a.useState(""),[c,m]=a.useState(!0),[d,w]=a.useState(null),[b,v]=a.useState(0),[y,f]=a.useState(!1);return a.useEffect(()=>{const i=async()=>{try{const g=localStorage.getItem("admin_token"),[p,j]=await Promise.allSettled([fetch("/api/nexus/dashboard",{headers:{Authorization:`Bearer ${g}`}}),fetch("/api/admin/sentinel-intelligence/health-score",{headers:{Authorization:`Bearer ${g}`}})]);if(p.status==="fulfilled"&&p.value.ok){const x=await p.value.json();n(x)}else throw new Error("Erreur API");if(j.status==="fulfilled"&&j.value.ok){const x=await j.value.json();r(x.healthScore?.score??x.score??null),o(x.healthScore?.status??x.status??"")}v(0),f(!0),setTimeout(()=>f(!1),500)}catch{w("Erreur chargement des données")}finally{m(!1)}};i();const u=setInterval(i,15e3);return()=>clearInterval(u)},[]),a.useEffect(()=>{const i=setInterval(()=>v(u=>u+1),1e3);return()=>clearInterval(i)},[]),e.jsx(E,{children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-white",children:"NEXUS Dashboard"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${y?"bg-cyan-400 shadow-[0_0_8px_#22d3ee]":"bg-green-400"} transition-all`}),e.jsx("span",{className:"text-[10px] text-slate-500",children:"LIVE"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 font-mono",children:[e.jsxs("span",{children:["MAJ il y a ",b,"s"]}),e.jsx("div",{className:`w-1 h-1 rounded-full ${b<5?"bg-green-400":b<15?"bg-yellow-400":"bg-red-400"}`})]})]}),c&&e.jsx(C,{}),d&&e.jsx("div",{className:"text-red-400",children:d}),t&&e.jsxs(e.Fragment,{children:[t.env==="development"&&e.jsxs("div",{className:"mb-3 px-3 py-2 bg-yellow-950/30 rounded-lg border border-yellow-800/50 text-[11px] text-yellow-500/80 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-500 flex-shrink-0"}),e.jsx("span",{children:"Environnement local — Le serveur tourne sur votre ordinateur (Mac). En production, il tournera sur un serveur cloud dedie."})]}),t.periodLabel&&e.jsxs("div",{className:"mb-3 text-[11px] text-slate-500",children:["Donnees cumulees ",e.jsx("span",{className:"text-slate-400 font-medium",children:t.periodLabel})," — sauvegardees en base de donnees (persistent meme apres redemarrage)."]}),s!=null&&e.jsxs("div",{className:"mb-4 flex items-center gap-4 bg-slate-900 rounded-lg border border-slate-800 p-3",children:[e.jsx($,{score:s}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-white font-medium",children:["Sante globale : ",e.jsx("span",{className:s>=80?"text-cyan-400":s>=50?"text-yellow-400":"text-red-400",children:l||(s>=80?"Excellent":s>=50?"Attention":"Critique")})]}),e.jsx("div",{className:"text-[10px] text-slate-600",children:"Score composite base sur les revenus, reservations, couts et disponibilite. Voir Sentinel pour le detail."})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 mb-6",children:[e.jsx(N,{title:"Tenants",subtitle:"Restaurants inscrits sur la plateforme",value:t.summary.totalTenants,color:"cyan"}),e.jsx(N,{title:"Appels IA",subtitle:"Conversations traitees par Claude",value:t.summary.totalCalls,color:"blue"}),e.jsx(N,{title:"Cout total",subtitle:t.periodLabel||"mois en cours",value:t.summary.totalCost,color:"purple",suffix:"€",decimals:2}),e.jsx(N,{title:"Alertes actives",subtitle:"Anomalies detectees par Sentinel",value:t.alerts.active,color:t.alerts.active>0?"red":"green"})]}),t.costBreakdown&&e.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 mb-6 p-4",children:[e.jsx("h2",{className:"font-semibold text-white mb-1",children:"Detail des couts par service"}),e.jsx("div",{className:"text-[10px] text-slate-600 mb-3",children:"Chaque service externe a un prix different. Voici la repartition."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(S,{label:"Anthropic Claude",desc:"Conversations IA, outils, analyse",value:t.costBreakdown.anthropic,total:t.summary.totalCost,color:"bg-purple-500"}),e.jsx(S,{label:"Twilio",desc:"SMS de rappel, appels telephoniques",value:t.costBreakdown.twilio,total:t.summary.totalCost,color:"bg-blue-500"}),e.jsx(S,{label:"ElevenLabs",desc:"Voix synthetique (Halimah vocale)",value:t.costBreakdown.elevenlabs,total:t.summary.totalCost,color:"bg-cyan-500"})]}),e.jsxs("div",{className:"mt-3 pt-2 border-t border-slate-800 flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm text-slate-400",children:["Total ",t.periodLabel]}),e.jsxs("span",{className:"text-lg font-bold text-white font-mono",children:[t.summary.totalCost.toFixed(2),"€"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-slate-800 flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold text-white",children:"Alertes SENTINEL"}),e.jsx("div",{className:`w-2 h-2 rounded-full ${t.alerts.active>0?"bg-red-500 animate-pulse":"bg-green-500"}`})]}),t.alerts.recent.length===0?e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("div",{className:"text-green-400 text-sm mb-1",children:"Aucune alerte"}),e.jsx("div",{className:"text-slate-600 text-xs",children:"Tous les systemes sont stables"})]}):e.jsx("div",{className:"divide-y divide-slate-800 max-h-[300px] overflow-y-auto",children:t.alerts.recent.slice(0,8).map((i,u)=>e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between hover:bg-slate-800/30 transition group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:`w-2.5 h-2.5 rounded-full block ${i.level==="critical"?"bg-red-500":"bg-yellow-500"}`}),i.level==="critical"&&e.jsx("span",{className:"w-2.5 h-2.5 rounded-full block bg-red-500 animate-ping absolute inset-0 opacity-50"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-white",children:i.tenant_id}),e.jsx("span",{className:"text-xs text-slate-500 ml-2",children:i.message})]})]}),e.jsx(I,{date:i.created_at})]},i.id||u))})]}),e.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800",children:[e.jsx("div",{className:"px-4 py-3 border-b border-slate-800",children:e.jsx("h2",{className:"font-semibold text-white",children:"Statut systeme"})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx(h,{label:"API Gateway",status:"ok",latency:12}),e.jsx(h,{label:"PostgreSQL",status:"ok",latency:3}),e.jsx(h,{label:"Sentinel",status:t.alerts.active>0?"warning":"ok"}),e.jsx(h,{label:"SMS (Twilio)",status:"ok"}),e.jsx(h,{label:"Voix (ElevenLabs)",status:"ok"}),e.jsx(h,{label:"Redis",status:"ok",latency:1}),e.jsx(h,{label:"WebSocket",status:"ok"})]})]})]}),e.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 p-4",children:[e.jsx("h2",{className:"font-semibold text-white mb-4",children:"Repartition par plan"}),e.jsx(A,{tenants:t.summary.totalTenants})]})]})]})})}function N({title:t,subtitle:n,value:s,color:r,prefix:l="",suffix:o="",decimals:c=0,icon:m}){const[d,w]=a.useState(0),b=a.useRef(s);b.current=s,a.useEffect(()=>{let f=d;const i=s,u=800,g=Date.now(),p=setInterval(()=>{const j=Date.now()-g,x=Math.min(j/u,1),k=1-Math.pow(1-x,3);w(f+(i-f)*k),x>=1&&clearInterval(p)},16);return()=>clearInterval(p)},[s]);const v={cyan:"border-cyan-800 bg-cyan-950/30",blue:"border-blue-800 bg-blue-950/30",purple:"border-purple-800 bg-purple-950/30",green:"border-green-800 bg-green-950/30",red:"border-red-800 bg-red-950/30"},y={cyan:"text-cyan-400",blue:"text-blue-400",purple:"text-purple-400",green:"text-green-400",red:"text-red-400"};return e.jsxs("div",{className:`p-4 rounded-lg border ${v[r]} transition-all duration-300 hover:brightness-110`,children:[e.jsx("div",{className:"text-sm text-slate-400 mb-0.5",children:t}),n&&e.jsx("div",{className:"text-[10px] text-slate-600 mb-1",children:n}),e.jsxs("div",{className:`text-2xl font-bold ${y[r]} tabular-nums`,children:[l,c>0?d.toFixed(c):Math.round(d),o]})]})}function I({date:t}){const[,n]=a.useState(0);a.useEffect(()=>{const l=setInterval(()=>n(o=>o+1),1e4);return()=>clearInterval(l)},[]);const s=Math.floor((Date.now()-new Date(t).getTime())/1e3);let r;return s<60?r=`${s}s`:s<3600?r=`${Math.floor(s/60)}m`:s<86400?r=`${Math.floor(s/3600)}h`:r=`${Math.floor(s/86400)}j`,e.jsxs("span",{className:"text-xs text-slate-600 font-mono",children:["il y a ",r]})}function h({label:t,status:n,latency:s}){const[r,l]=a.useState(!1);a.useEffect(()=>{const c=setInterval(()=>{l(!0),setTimeout(()=>l(!1),300)},3e3+Math.random()*4e3);return()=>clearInterval(c)},[]);const o=n==="ok"?"bg-green-500":n==="warning"?"bg-yellow-500":"bg-red-500";return e.jsxs("div",{className:"flex items-center justify-between group hover:bg-slate-800/20 rounded px-2 py-1.5 -mx-2 transition",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:`w-2 h-2 rounded-full block ${o}`}),r&&e.jsx("span",{className:`w-2 h-2 rounded-full block ${o} animate-ping absolute inset-0 opacity-50`})]}),e.jsx("span",{className:"text-sm text-slate-400",children:t})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s!=null&&e.jsxs("span",{className:`text-[10px] font-mono ${s<10?"text-green-500":s<50?"text-yellow-500":"text-red-500"}`,children:[s,"ms"]}),e.jsx("span",{className:"text-xs text-slate-500 capitalize",children:n})]})]})}function A({tenants:t}){const[n,s]=a.useState(!1);a.useEffect(()=>{setTimeout(()=>s(!0),100)},[]);const r=[{name:"Starter",pct:60,color:"bg-cyan-600",glow:"shadow-cyan-500/20"},{name:"Pro",pct:30,color:"bg-blue-600",glow:"shadow-blue-500/20"},{name:"Business",pct:10,color:"bg-purple-600",glow:"shadow-purple-500/20"}];return e.jsx("div",{className:"space-y-3",children:r.map(l=>{const o=Math.max(1,Math.round(t*l.pct/100));return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-16 text-sm text-slate-400",children:l.name}),e.jsx("div",{className:"flex-1 bg-slate-800 rounded-full h-6 overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${l.color} ${l.glow} shadow-lg transition-all duration-1000 ease-out`,style:{width:n?`${l.pct}%`:"0%"}})}),e.jsx("span",{className:"text-xs text-slate-400 w-8 text-right font-mono",children:o})]},l.name)})})}function $({score:t}){const[n,s]=a.useState(0);a.useEffect(()=>{const c=Date.now(),m=setInterval(()=>{const d=Math.min((Date.now()-c)/1e3,1);s(t*(1-Math.pow(1-d,3))),d>=1&&clearInterval(m)},16);return()=>clearInterval(m)},[t]);const r=t>=80?"#22d3ee":t>=50?"#eab308":"#ef4444",l=20,o=2*Math.PI*l;return e.jsxs("svg",{width:"56",height:"56",viewBox:"0 0 56 56",className:"flex-shrink-0",children:[e.jsx("circle",{cx:"28",cy:"28",r:l,fill:"none",stroke:"#1e293b",strokeWidth:"5"}),e.jsx("circle",{cx:"28",cy:"28",r:l,fill:"none",stroke:r,strokeWidth:"5",strokeLinecap:"round",strokeDasharray:o,strokeDashoffset:o-n/100*o,transform:"rotate(-90 28 28)",className:"transition-all duration-1000"}),e.jsx("text",{x:"28",y:"32",textAnchor:"middle",fill:"white",fontSize:"14",fontWeight:"bold",children:Math.round(n)})]})}function S({label:t,desc:n,value:s,total:r,color:l}){const o=r>0?s/r*100:0,[c,m]=a.useState(0);return a.useEffect(()=>{setTimeout(()=>m(o),100)},[o]),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-slate-300",children:t}),e.jsx("span",{className:"text-[10px] text-slate-600 ml-2",children:n})]}),e.jsxs("span",{className:"text-sm text-white font-mono font-bold",children:[s.toFixed(4),"€"]})]}),e.jsx("div",{className:"h-2 bg-slate-800 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${l} transition-all duration-1000 ease-out`,style:{width:`${Math.max(c,s>0?2:0)}%`}})})]})}function C(){return e.jsx("div",{className:"space-y-4",children:[1,2,3].map(t=>e.jsx("div",{className:"h-20 bg-slate-900 rounded-lg border border-slate-800 animate-pulse"},t))})}export{G as default};
