import{r as a,j as e}from"./index-_yXYEqcL.js";function h(s,n=800){const[o,d]=a.useState(0),r=a.useRef(0);return a.useEffect(()=>{const l=r.current,x=s-l;if(x===0)return;const i=Date.now(),u=setInterval(()=>{const p=Date.now()-i,m=Math.min(p/n,1),g=1-Math.pow(1-m,3);d(Math.round(l+x*g)),m>=1&&(clearInterval(u),r.current=s)},16);return()=>clearInterval(u)},[s,n]),o}function w(){const[s,n]=a.useState(null),[o,d]=a.useState(!0),[r,l]=a.useState(!1),x=()=>localStorage.getItem("nexus_token")||localStorage.getItem("admin_token"),i=a.useCallback(async()=>{try{const t=await fetch("/api/sentinel/autopilot/status",{headers:{Authorization:`Bearer ${x()}`}});if(t.ok){const c=await t.json();c.success&&n(c)}}catch(t){console.error("Autopilot fetch error:",t)}finally{d(!1)}},[]);a.useEffect(()=>{i();const t=setInterval(i,1e4);return()=>clearInterval(t)},[i]),a.useEffect(()=>{if(s?.stats.lastScanAt){l(!0);const t=setTimeout(()=>l(!1),2e3);return()=>clearTimeout(t)}},[s?.stats.lastScanAt]);const u=t=>{switch(t){case"PRELOAD_CACHE":return"ðŸ“¦";case"CLEANUP_CACHE":return"ðŸ§¹";case"ADJUST_ROUTER":return"ðŸ”€";case"BUDGET_ALERT":return"ðŸ’°";case"OPPORTUNITY":return"ðŸ’¡";default:return"âš™ï¸"}},p=t=>{switch(t){case"executed":return{text:"Execute",class:"bg-green-950/50 text-green-400 border-green-800/50"};case"proposed":return{text:"En attente",class:"bg-cyan-950/50 text-cyan-400 border-cyan-800/50"};case"failed":return{text:"Echoue",class:"bg-red-950/50 text-red-400 border-red-800/50"};case"rejected":return{text:"Rejete",class:"bg-slate-800/50 text-slate-400 border-slate-700/50"};default:return{text:t,class:"bg-slate-800/50 text-slate-400 border-slate-700/50"}}},m=h(s?.stats.totalScans||0),g=h(s?.stats.totalActionsProposed||0),b=h(s?.stats.totalActionsExecuted||0),j=s?.recentActions.filter(t=>t.status==="proposed").length||0;if(o)return e.jsx("div",{className:"space-y-4",children:[1,2,3].map(t=>e.jsx("div",{className:"h-20 bg-slate-900 rounded-lg border border-slate-800 animate-pulse",style:{animationDelay:`${t*150}ms`}},t))});const f=[...s?.recentActions||[]].sort((t,c)=>new Date(c.executedAt||c.createdAt).getTime()-new Date(t.executedAt||t.createdAt).getTime());return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-900/50 rounded-lg border border-slate-800 p-4 relative overflow-hidden",children:[r&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-cyan-500/5 via-cyan-500/10 to-transparent animate-pulse"}),e.jsxs("div",{className:"flex items-center justify-between relative",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"text-3xl",children:"ðŸ¤–"}),e.jsx("span",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-slate-900 animate-pulse"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"NEXUS AUTOPILOT"}),e.jsxs("p",{className:"text-xs text-green-400 flex items-center gap-1.5",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"}),"Mode autonome actif â€” scan toutes les 30 min"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"px-3 py-1.5 rounded-lg bg-green-950/50 border border-green-800/50 text-green-400 text-xs font-mono flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),"ACTIF"]})})]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[{label:"Scans",value:m,color:"cyan",icon:"ðŸ”"},{label:"Proposees",value:g,color:"purple",icon:"ðŸ“‹"},{label:"Executees",value:b,color:"green",icon:"âœ…"},{label:"En attente",value:j,color:"orange",icon:"â³"}].map((t,c)=>e.jsx(v,{stat:t,index:c},t.label))}),s?.stats.lastScanAt&&e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-slate-900/30 rounded-lg border border-slate-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${r?"bg-cyan-400 animate-ping":"bg-cyan-500"}`}),e.jsx("span",{className:"text-[11px] text-slate-400",children:"Dernier scan"})]}),e.jsx("span",{className:"text-[11px] text-slate-500 font-mono",children:new Date(s.stats.lastScanAt).toLocaleTimeString("fr-FR")})]}),e.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-slate-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-cyan-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Flux d'activite"})]}),e.jsxs("span",{className:"text-[10px] text-slate-500 font-mono",children:[f.length," actions"]})]}),e.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:f.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"text-2xl mb-2 animate-bounce",children:"ðŸ”"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Premier scan en cours..."}),e.jsx("div",{className:"mt-3 flex justify-center gap-1",children:[0,1,2].map(t=>e.jsx("div",{className:"w-1.5 h-1.5 bg-cyan-500 rounded-full animate-bounce",style:{animationDelay:`${t*150}ms`}},t))})]}):e.jsx("div",{className:"divide-y divide-slate-800/50",children:f.map((t,c)=>e.jsx(N,{action:t,index:c,getTypeIcon:u,getStatusBadge:p},t.id))})})]})]})}function v({stat:s,index:n}){const[o,d]=a.useState(!1);a.useEffect(()=>{const l=setTimeout(()=>d(!0),n*100);return()=>clearTimeout(l)},[n]);const r={cyan:"text-cyan-400",purple:"text-purple-400",green:"text-green-400",orange:"text-orange-400"};return e.jsxs("div",{className:`bg-slate-900/30 rounded-lg border border-slate-800 p-3 text-center transition-all duration-500 ${o?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:[e.jsx("div",{className:"text-lg mb-0.5",children:s.icon}),e.jsx("div",{className:`text-xl font-bold font-mono ${r[s.color]}`,children:s.value}),e.jsx("div",{className:"text-[10px] text-slate-500",children:s.label})]})}function N({action:s,index:n,getTypeIcon:o,getStatusBadge:d}){const[r,l]=a.useState(!1);a.useEffect(()=>{const u=setTimeout(()=>l(!0),Math.min(n*60,600));return()=>clearTimeout(u)},[n]);const x=d(s.status),i=s.executedAt||s.createdAt;return e.jsx("div",{className:`px-4 py-3 hover:bg-slate-800/30 transition-all duration-500 ${r?"opacity-100 translate-x-0":"opacity-0 -translate-x-4"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-lg mt-0.5",children:o(s.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm text-white font-medium",children:s.title}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[9px] border ${x.class}`,children:x.text}),s.autoExecutable&&s.status==="executed"&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] bg-green-950/30 text-green-500 border border-green-800/30",children:"Auto"})]}),e.jsx("p",{className:"text-[11px] text-slate-500 mt-0.5 truncate",children:s.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsx("span",{className:"text-[10px] text-slate-600 font-mono",children:i?new Date(i).toLocaleTimeString("fr-FR"):""}),s.estimatedSaving&&e.jsxs("span",{className:"text-[10px] text-slate-600",children:["ðŸ’° ",s.estimatedSaving]})]})]})]})})}export{w as default};
