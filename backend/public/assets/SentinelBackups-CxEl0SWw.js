import{r as n,j as e}from"./index-_yXYEqcL.js";const d=()=>({Authorization:`Bearer ${localStorage.getItem("admin_token")}`,"Content-Type":"application/json"});function f(){const[a,x]=n.useState([]),[p,m]=n.useState(!0),[c,i]=n.useState(null),[l,s]=n.useState(null),u=async()=>{try{const t=await fetch("/api/nexus/sentinel/backups",{headers:d()});if(t.ok){const r=await t.json(),o=r.data??r;x(Array.isArray(o)?o:o.backups||[])}}catch{}finally{m(!1)}};n.useEffect(()=>{u()},[]);const h=async()=>{i("create"),s(null);try{(await fetch("/api/nexus/sentinel/backups",{method:"POST",headers:d()})).ok?(s({text:"Backup cree avec succes",type:"ok"}),await u()):s({text:"Erreur lors de la creation",type:"error"})}catch{s({text:"Erreur reseau",type:"error"})}finally{i(null)}},y=async t=>{if(confirm(`Restaurer le backup "${t}" ? Cette action va remplacer les donnees actuelles.`)){i(`restore-${t}`),s(null);try{(await fetch(`/api/nexus/sentinel/backups/${encodeURIComponent(t)}/restore`,{method:"POST",headers:d()})).ok?s({text:`Backup "${t}" restaure`,type:"ok"}):s({text:"Erreur lors de la restauration",type:"error"})}catch{s({text:"Erreur reseau",type:"error"})}finally{i(null)}}};return p?e.jsx("div",{className:"space-y-4",children:[1,2].map(t=>e.jsx("div",{className:"h-20 bg-slate-900 rounded-lg animate-pulse"},t))}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("div",{className:"text-[10px] text-slate-600",children:"Les backups sauvegardent la configuration et les donnees de la plateforme"})}),e.jsx("button",{onClick:h,disabled:!!c,className:"px-3 py-1.5 text-xs bg-cyan-900/50 text-cyan-400 border border-cyan-800 rounded-lg hover:bg-cyan-900 transition disabled:opacity-50",children:c==="create"?"Creation...":"Nouveau backup"})]}),l&&e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm ${l.type==="ok"?"bg-green-950/50 text-green-400 border border-green-800":"bg-red-950/50 text-red-400 border border-red-800"}`,children:l.text}),e.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 border-b border-slate-800",children:e.jsx("div",{className:"text-sm font-medium text-white",children:"Backups disponibles"})}),a.length===0?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"text-slate-400 text-sm",children:"Aucun backup"}),e.jsx("div",{className:"text-[10px] text-slate-600 mt-1",children:'Cliquez sur "Nouveau backup" pour creer votre premiere sauvegarde'})]}):e.jsx("div",{className:"divide-y divide-slate-800",children:a.map((t,r)=>e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between hover:bg-slate-800/30 transition",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm text-white font-mono truncate",children:t.name}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5",children:[e.jsx("span",{className:"text-[10px] text-slate-500",children:g(t.date||t.created_at)}),t.size&&e.jsx("span",{className:"text-[10px] text-slate-600",children:t.size}),t.type&&e.jsx("span",{className:"text-[10px] text-slate-600 capitalize",children:t.type})]})]}),e.jsx("button",{onClick:()=>y(t.name),disabled:!!c,className:"text-[11px] px-2.5 py-1 bg-slate-700 text-slate-300 rounded hover:bg-slate-600 transition disabled:opacity-50 whitespace-nowrap",children:c===`restore-${t.name}`?"Restauration...":"Restaurer"})]},t.name||r))})]}),e.jsx("div",{className:"bg-slate-800/30 rounded-lg border border-slate-700/50 p-3",children:e.jsxs("div",{className:"text-[11px] text-slate-500",children:[e.jsx("strong",{className:"text-slate-400",children:"Backups automatiques :"})," Les backups incluent les configurations tenants, les parametres Sentinel, et les metriques d'usage. La restauration remplace les donnees actuelles par celles du backup selectionne."]})})]})}function g(a){if(!a)return"";try{return new Date(a).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return a}}export{f as default};
