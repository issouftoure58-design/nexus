import{r as s,j as e}from"./index-_yXYEqcL.js";const E=()=>({Authorization:`Bearer ${localStorage.getItem("admin_token")}`});function L(n,o=1e3,i=0){const[c,a]=s.useState(0),u=s.useRef(0);return s.useEffect(()=>{const l=u.current,d=n-l;if(Math.abs(d)<.001)return;const h=Date.now(),m=setInterval(()=>{const v=Date.now()-h,p=Math.min(v/o,1),f=1-Math.pow(1-p,3),j=l+d*f;a(i>0?parseFloat(j.toFixed(i)):Math.round(j)),p>=1&&(clearInterval(m),u.current=n)},16);return()=>clearInterval(m)},[n,o,i]),c}function H(){const[n,o]=s.useState(null),[i,c]=s.useState(null),[a,u]=s.useState(null),[l,d]=s.useState(null),[h,m]=s.useState(null),[v,p]=s.useState(!0);if(s.useEffect(()=>{const r=async()=>{try{const[x,b,g]=await Promise.allSettled([fetch("/api/nexus/dashboard",{headers:E()}),fetch("/api/optimization/cache/stats",{headers:E()}),fetch("/api/optimization/pricing",{headers:E()})]);if(x.status==="fulfilled"&&x.value.ok){const t=await x.value.json(),D=t.costBreakdown?.anthropic||0,T=t.costBreakdown?.twilio||0,A=t.costBreakdown?.elevenlabs||0,B=t.summary?.totalCalls||0,F=t.twilioDetails?.sms?.count||0,$=t.twilioDetails?.voice?.count||0,R=t.elevenLabsDetails?.characters||0;c({totalCost:D+T+A,services:{claude:{cost:D,calls:B},elevenlabs:{cost:A,calls:R},twilio:{cost:T,calls:F+$},dalle:{cost:0,calls:0},tavily:{cost:0,calls:0}}});const y=t.todayCosts;o(y?{totalCost:y.total||0,services:{claude:{cost:y.anthropic||0,calls:0},elevenlabs:{cost:y.elevenlabs||0,calls:0},twilio:{cost:y.twilio||0,calls:0},dalle:{cost:0,calls:0},tavily:{cost:0,calls:0}}}:{totalCost:0,services:{}}),u({services:{claude:{spent:D,budget:150},elevenlabs:{spent:A,budget:20},twilio:{spent:T,budget:80},dalle:{spent:0,budget:30},tavily:{spent:0,budget:10}}})}if(b.status==="fulfilled"&&b.value.ok){const t=await b.value.json();d(t?.data??t)}if(g.status==="fulfilled"&&g.value.ok){const t=await g.value.json();m(t?.data??t)}}catch(x){console.error("[SentinelCosts] Error:",x)}finally{p(!1)}};r();const M=setInterval(r,3e4);return()=>clearInterval(M)},[]),v)return e.jsx("div",{className:"space-y-4",children:[1,2,3].map(r=>e.jsx("div",{className:"h-28 bg-slate-900 rounded-lg animate-pulse",style:{animationDelay:`${r*150}ms`}},r))});const f=["claude","elevenlabs","twilio","dalle","tavily"],j={claude:"Anthropic Claude",elevenlabs:"ElevenLabs",twilio:"Twilio",dalle:"DALL-E (images)",tavily:"Tavily (recherche)"},C={claude:"Conversations IA, outils, analyse de texte",elevenlabs:"Synthese vocale pour Halimah",twilio:"SMS de rappel, appels telephoniques, WhatsApp",dalle:"Generation d'images pour reseaux sociaux",tavily:"Recherche web pour enrichir les reponses IA"},S={claude:"bg-purple-500",elevenlabs:"bg-cyan-500",twilio:"bg-blue-500",dalle:"bg-pink-500",tavily:"bg-green-500"},k=n?.totalCost??0,I=i?.totalCost??0;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(w,{label:"Cout aujourd'hui",value:k,suffix:"€",decimals:4,color:"cyan",desc:"Depenses du jour en cours",index:0}),e.jsx(w,{label:"Cout du mois",value:I,suffix:"€",decimals:4,color:"blue",desc:"Cumul depuis le 1er du mois",index:1}),e.jsx(w,{label:"Fichiers en cache",value:l?.totalFiles??l?.hits??0,suffix:"",decimals:0,color:"green",desc:"Fichiers mis en cache",index:2}),e.jsx(w,{label:"Taille cache",value:parseFloat(l?.totalSizeMB??"0"),suffix:"MB",decimals:1,color:"purple",desc:"Espace utilise par le cache",index:3})]}),e.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 p-4",children:[e.jsx("div",{className:"text-sm font-medium text-white mb-1",children:"Budget par service"}),e.jsx("div",{className:"text-[10px] text-slate-600 mb-4",children:"Chaque service a un budget mensuel. La barre montre le % consomme."}),e.jsx("div",{className:"space-y-3",children:f.map((r,M)=>{const x=a?.services?.[r],b=x?.spent??0,g=x?.budget??150,t=g>0?Math.min((typeof b=="number"?b:0)/g*100,100):0;return e.jsx(V,{label:j[r],desc:C[r],spent:typeof b=="number"?b:0,limit:g,pct:t,color:S[r],index:M},r)})})]}),h&&e.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 p-4",children:[e.jsx("div",{className:"text-sm font-medium text-white mb-1",children:"Grille tarifaire des services"}),e.jsx("div",{className:"text-[10px] text-slate-600 mb-3",children:"Prix unitaires factures par les fournisseurs externes"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsx(N,{title:"Claude IA",items:[{label:"Haiku (rapide)",price:"0.25€ / 1M tokens entree"},{label:"Sonnet (standard)",price:"3€ / 1M tokens entree"},{label:"Opus (puissant)",price:"15€ / 1M tokens entree"}]}),e.jsx(N,{title:"Twilio",items:[{label:"SMS sortant (France)",price:"0.0725€ / SMS"},{label:"SMS entrant",price:"0.0075€ / SMS"},{label:"Appel vocal",price:"0.015€ / minute"}]}),e.jsx(N,{title:"ElevenLabs",items:[{label:"Voix Turbo",price:"0.00015€ / caractere"},{label:"Voix Multilingual",price:"0.00030€ / caractere"}]}),e.jsx(N,{title:"Autres",items:[{label:"DALL-E Standard",price:"0.04€ / image"},{label:"DALL-E HD",price:"0.08€ / image"},{label:"Tavily recherche",price:"0.003€ / requete"}]})]})]})]})}function w({label:n,value:o,suffix:i,decimals:c,color:a,desc:u,index:l}){const d=L(o,1200,c),[h,m]=s.useState(!1);s.useEffect(()=>{const f=setTimeout(()=>m(!0),l*100);return()=>clearTimeout(f)},[l]);const v={cyan:"border-cyan-800 bg-cyan-950/30",blue:"border-blue-800 bg-blue-950/30",green:"border-green-800 bg-green-950/30",purple:"border-purple-800 bg-purple-950/30"},p={cyan:"text-cyan-400",blue:"text-blue-400",green:"text-green-400",purple:"text-purple-400"};return e.jsxs("div",{className:`p-3 rounded-lg border ${v[a]} transition-all duration-500 ${h?"opacity-100 translate-y-0":"opacity-0 translate-y-3"}`,children:[e.jsx("div",{className:"text-[11px] text-slate-400",children:n}),e.jsxs("div",{className:`text-lg font-bold font-mono ${p[a]}`,children:[c>0?d.toFixed(c):d,i]}),e.jsx("div",{className:"text-[9px] text-slate-600 mt-0.5",children:u})]})}function V({label:n,desc:o,spent:i,limit:c,pct:a,color:u,index:l}){const[d,h]=s.useState(0),[m,v]=s.useState(!1),p=L(i,1e3,4);s.useEffect(()=>{const C=setTimeout(()=>v(!0),l*80),S=setTimeout(()=>h(a),l*80+300);return()=>{clearTimeout(C),clearTimeout(S)}},[l,a]);const f=a>80?"bg-red-500":a>60?"bg-yellow-500":u,j=a>80?"shadow-red-500/30":a>60?"shadow-yellow-500/30":"";return e.jsxs("div",{className:`transition-all duration-500 ${m?"opacity-100 translate-x-0":"opacity-0 -translate-x-4"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-slate-300",children:n}),e.jsx("span",{className:"text-[10px] text-slate-600 ml-2",children:o})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-sm text-white font-mono",children:[p.toFixed(4),"€"]}),e.jsxs("span",{className:"text-[10px] text-slate-600",children:[" / ",c,"€"]})]})]}),e.jsx("div",{className:"h-2.5 bg-slate-800 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${f} shadow-sm ${j}`,style:{width:`${Math.max(d,a>0?1:0)}%`,transition:"width 1.2s cubic-bezier(0.22, 1, 0.36, 1)"}})})]})}function N({title:n,items:o}){return e.jsxs("div",{className:"bg-slate-800/40 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs font-medium text-slate-300 mb-2",children:n}),e.jsx("div",{className:"space-y-1.5",children:o.map((i,c)=>e.jsxs("div",{className:"flex justify-between text-[11px]",children:[e.jsx("span",{className:"text-slate-500",children:i.label}),e.jsx("span",{className:"text-slate-300 font-mono",children:i.price})]},c))})]})}export{H as default};
