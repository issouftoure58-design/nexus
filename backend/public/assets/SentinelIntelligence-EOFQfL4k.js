import{r as c,j as e}from"./index-_yXYEqcL.js";const r=()=>({Authorization:`Bearer ${localStorage.getItem("admin_token")}`,"Content-Type":"application/json"});function P(){const[a,x]=c.useState([]),[p,y]=c.useState([]),[h,j]=c.useState([]),[b,v]=c.useState(!0),[n,l]=c.useState(null),o=async()=>{try{const[t,d,m]=await Promise.allSettled([fetch("/api/admin/sentinel-intelligence/anomalies",{headers:r()}),fetch("/api/admin/sentinel-intelligence/predictions",{headers:r()}),fetch("/api/admin/sentinel-intelligence/recommendations",{headers:r()})]);if(t.status==="fulfilled"&&t.value.ok){const i=await t.value.json(),s=i.data??i;x(Array.isArray(s)?s:s.anomalies||[])}if(d.status==="fulfilled"&&d.value.ok){const i=await d.value.json(),s=i.data??i;y(Array.isArray(s)?s:s.predictions||[])}if(m.status==="fulfilled"&&m.value.ok){const i=await m.value.json(),s=i.data??i;j(Array.isArray(s)?s:s.recommendations||[])}}catch{}finally{v(!1)}};c.useEffect(()=>{o()},[]);const f=async()=>{l("detect");try{await fetch("/api/admin/sentinel-intelligence/anomalies/detect",{method:"POST",headers:r()}),await o()}catch{}finally{l(null)}},N=async()=>{l("predict");try{await fetch("/api/admin/sentinel-intelligence/predictions/generate",{method:"POST",headers:r()}),await o()}catch{}finally{l(null)}},w=async t=>{l(`inv-${t}`);try{await fetch(`/api/admin/sentinel-intelligence/anomalies/${t}/investigate`,{method:"POST",headers:r()}),await o()}catch{}finally{l(null)}};if(b)return e.jsx("div",{className:"space-y-4",children:[1,2,3].map(t=>e.jsx("div",{className:"h-28 bg-slate-900 rounded-lg animate-pulse"},t))});const A={critical:"text-red-400 bg-red-950",high:"text-orange-400 bg-orange-950",medium:"text-yellow-400 bg-yellow-950",low:"text-blue-400 bg-blue-950"},S={high:"text-red-400",medium:"text-yellow-400",low:"text-blue-400"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:f,disabled:!!n,className:"px-3 py-1.5 text-xs bg-cyan-900/50 text-cyan-400 border border-cyan-800 rounded-lg hover:bg-cyan-900 transition disabled:opacity-50",children:n==="detect"?"Analyse...":"Detecter anomalies"}),e.jsx("button",{onClick:N,disabled:!!n,className:"px-3 py-1.5 text-xs bg-purple-900/50 text-purple-400 border border-purple-800 rounded-lg hover:bg-purple-900 transition disabled:opacity-50",children:n==="predict"?"Generation...":"Generer predictions"})]}),e.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:"Anomalies detectees"}),e.jsx("div",{className:"text-[10px] text-slate-600",children:"Comportements inhabituels identifies par l'IA"})]}),a.length>0&&e.jsx("span",{className:"px-1.5 py-0.5 text-[10px] bg-red-950 text-red-400 rounded",children:a.length})]}),a.length===0?e.jsx(u,{text:"Aucune anomalie detectee",sub:"Cliquez sur 'Detecter anomalies' pour lancer une analyse"}):e.jsx("div",{className:"space-y-2 max-h-[300px] overflow-y-auto",children:a.map(t=>e.jsx("div",{className:"bg-slate-800/50 rounded-lg p-3 hover:bg-slate-800 transition",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${A[t.severity||"medium"]}`,children:t.severity||"medium"}),e.jsx("span",{className:"text-xs text-white",children:t.metric||t.type||"Anomalie"})]}),e.jsx("div",{className:"text-[11px] text-slate-400",children:t.description||"Comportement anormal detecte"}),e.jsx("div",{className:"text-[10px] text-slate-600 mt-1",children:g(t.detected_at||t.created_at)})]}),e.jsx("button",{onClick:()=>w(t.id),disabled:!!n,className:"text-[10px] px-2 py-1 bg-slate-700 text-slate-300 rounded hover:bg-slate-600 transition whitespace-nowrap disabled:opacity-50",children:n===`inv-${t.id}`?"...":"Investiguer"})]})},t.id))})]}),e.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 p-4",children:[e.jsx("div",{className:"text-sm font-medium text-white mb-1",children:"Predictions"}),e.jsx("div",{className:"text-[10px] text-slate-600 mb-3",children:"Projections basees sur l'historique des metriques"}),p.length===0?e.jsx(u,{text:"Aucune prediction",sub:"Cliquez sur 'Generer predictions' pour creer des projections"}):e.jsx("div",{className:"grid md:grid-cols-2 gap-2",children:p.map(t=>e.jsxs("div",{className:"bg-slate-800/40 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-slate-300 mb-1",children:t.metric||"Metrique"}),e.jsx("div",{className:"text-lg font-bold text-white font-mono",children:t.predicted_value?.toFixed(2)??"---"}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx("span",{className:"text-[10px] text-slate-600",children:g(t.target_date)}),t.accuracy!=null&&e.jsxs("span",{className:`text-[10px] font-mono ${t.accuracy>80?"text-green-400":t.accuracy>50?"text-yellow-400":"text-red-400"}`,children:[t.accuracy,"% fiable"]})]})]},t.id))})]}),e.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 p-4",children:[e.jsx("div",{className:"text-sm font-medium text-white mb-1",children:"Recommandations"}),e.jsx("div",{className:"text-[10px] text-slate-600 mb-3",children:"Actions suggerees pour ameliorer votre activite"}),h.length===0?e.jsx(u,{text:"Aucune recommandation",sub:"Les recommandations apparaissent quand Sentinel detecte des opportunites d'amelioration"}):e.jsx("div",{className:"space-y-2",children:h.map((t,d)=>e.jsxs("div",{className:"bg-slate-800/40 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.priority&&e.jsx("span",{className:`text-[10px] font-medium ${S[t.priority]||"text-slate-400"}`,children:t.priority}),t.category&&e.jsx("span",{className:"text-[10px] text-slate-600",children:t.category})]}),e.jsx("div",{className:"text-sm text-white",children:t.title||t.description}),t.title&&t.description&&e.jsx("div",{className:"text-[11px] text-slate-400 mt-1",children:t.description}),t.action&&e.jsxs("div",{className:"text-[10px] text-cyan-400 mt-1.5",children:["Action : ",t.action]})]},t.id||d))})]})]})}function u({text:a,sub:x}){return e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"text-slate-400 text-sm",children:a}),e.jsx("div",{className:"text-[10px] text-slate-600 mt-1",children:x})]})}function g(a){if(!a)return"";try{return new Date(a).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return a}}export{P as default};
