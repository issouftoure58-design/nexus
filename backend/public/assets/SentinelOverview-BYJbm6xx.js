import{r as n,j as e}from"./index-_yXYEqcL.js";const w=()=>({Authorization:`Bearer ${localStorage.getItem("admin_token")}`});function k(t,s=1200){const[i,c]=n.useState(0),l=n.useRef(0);return n.useEffect(()=>{const r=l.current,d=t-r;if(d===0)return;const h=Date.now(),x=setInterval(()=>{const g=Date.now()-h,f=Math.min(g/s,1),v=1-Math.pow(1-f,3);c(Math.round(r+d*v)),f>=1&&(clearInterval(x),l.current=t)},16);return()=>clearInterval(x)},[t,s]),i}function T(){const[t,s]=n.useState(null),[i,c]=n.useState([]),[l,r]=n.useState([]),[d,h]=n.useState(!0),[x,g]=n.useState(null);n.useEffect(()=>{const a=async()=>{try{const[j,b,y]=await Promise.allSettled([fetch("/api/admin/sentinel-intelligence/health-score",{headers:w()}),fetch("/api/nexus/sentinel/status",{headers:w()}),fetch("/api/admin/sentinel-intelligence/alerts?status=active",{headers:w()})]);if(j.status==="fulfilled"&&j.value.ok){const m=await j.value.json(),u=m.data||m;s(u.healthScore||u)}if(b.status==="fulfilled"&&b.value.ok){const m=await b.value.json(),u=m.services||m.checks||{};Array.isArray(u)?c(u):c(Object.values(u))}if(y.status==="fulfilled"&&y.value.ok){const m=await y.value.json(),u=m.data||m;r(Array.isArray(u)?u:u.alerts||[])}g(new Date)}catch{}finally{h(!1)}};a();const o=setInterval(a,15e3);return()=>clearInterval(o)},[]);const f=a=>a>=80?"#22d3ee":a>=50?"#eab308":"#ef4444",v=a=>a>=80?"Excellent":a>=50?"Attention":"Critique";if(d)return e.jsx(I,{});const p=t?.score??0;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 p-5 flex flex-col items-center justify-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",style:{background:`radial-gradient(circle at center, ${f(p)}33 0%, transparent 70%)`}}),e.jsx("div",{className:"text-xs text-slate-500 mb-3 relative",children:"HEALTH SCORE"}),e.jsx(A,{score:p,color:f(p)}),e.jsx("div",{className:"mt-2 text-sm font-medium relative",style:{color:f(p)},children:v(p)}),e.jsx("div",{className:"text-[10px] text-slate-600 mt-1 relative",children:"Sante technique de la plateforme"})]}),e.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 p-4 md:col-span-2",children:[e.jsx("div",{className:"text-sm font-medium text-white mb-3",children:"Sante plateforme"}),e.jsx("div",{className:"text-[10px] text-slate-600 mb-3",children:"Chaque dimension technique contribue au score global"}),t?.breakdown?e.jsx("div",{className:"space-y-2.5",children:Object.entries(t.breakdown).map(([a,o])=>e.jsx(N,{label:a,value:typeof o=="number"?o:0},a))}):e.jsx("div",{className:"space-y-2.5",children:["uptime","latency","security","performance","stability"].map(a=>e.jsx(N,{label:a,value:p},a))})]})]}),e.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:"Statut des services"}),e.jsx("div",{className:"text-[10px] text-slate-600",children:"Verification automatique toutes les 15s"})]}),e.jsx(E,{lastUpdate:x})]}),i.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:i.map((a,o)=>e.jsx(S,{service:a,index:o},o))}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:["API Gateway","PostgreSQL","Claude API","Twilio","ElevenLabs","Redis","WebSocket"].map((a,o)=>e.jsx(S,{service:{name:a,status:"ok"},index:o},a))})]}),e.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 p-4",children:[e.jsxs("div",{className:"text-sm font-medium text-white mb-3",children:["Alertes actives",l.length>0&&e.jsx("span",{className:"ml-2 px-1.5 py-0.5 text-[10px] bg-red-950 text-red-400 rounded animate-pulse",children:l.length})]}),l.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsxs("div",{className:"text-green-400 text-sm flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),"Aucune alerte active"]}),e.jsx("div",{className:"text-[10px] text-slate-600 mt-1",children:"Tous les systemes fonctionnent normalement"})]}):e.jsx("div",{className:"space-y-2 max-h-[250px] overflow-y-auto",children:l.slice(0,15).map((a,o)=>e.jsx($,{alert:a,index:o},a.id||o))})]})]})}function A({score:t,color:s}){const i=k(t),c=50,l=2*Math.PI*c,r=l-i/100*l*.75;return e.jsxs("svg",{width:"130",height:"100",viewBox:"0 0 130 100",className:"relative",children:[e.jsx("path",{d:"M 15 85 A 50 50 0 1 1 115 85",fill:"none",stroke:"#1e293b",strokeWidth:"10",strokeLinecap:"round"}),e.jsx("path",{d:"M 15 85 A 50 50 0 1 1 115 85",fill:"none",stroke:s,strokeWidth:"10",strokeLinecap:"round",strokeDasharray:`${l*.75}`,strokeDashoffset:r,style:{transition:"stroke-dashoffset 1.2s cubic-bezier(0.22, 1, 0.36, 1)",filter:`drop-shadow(0 0 6px ${s}66)`}}),e.jsx("text",{x:"65",y:"65",textAnchor:"middle",className:"text-2xl font-bold",fill:"white",fontSize:"28",children:i}),e.jsx("text",{x:"65",y:"82",textAnchor:"middle",fill:"#64748b",fontSize:"10",children:"/100"})]})}function N({label:t,value:s}){const[i,c]=n.useState(0),l=k(Math.round(s),800);n.useEffect(()=>{const x=setTimeout(()=>c(s),200);return()=>clearTimeout(x)},[s]);const r=s>=80?"bg-cyan-500":s>=50?"bg-yellow-500":"bg-red-500",d=s>=80?"shadow-cyan-500/30":s>=50?"shadow-yellow-500/30":"shadow-red-500/30",h={uptime:"Disponibilite",latency:"Latence",security:"Securite",performance:"Performance",stability:"Stabilite"};return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-24 text-xs text-slate-400 capitalize",children:h[t]||t}),e.jsx("div",{className:"flex-1 h-2.5 bg-slate-800 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${r} shadow-sm ${d}`,style:{width:`${Math.min(i,100)}%`,transition:"width 1s cubic-bezier(0.22, 1, 0.36, 1)"}})}),e.jsx("span",{className:"text-xs text-slate-500 w-10 text-right font-mono",children:l})]})}function S({service:t,index:s}){const[i,c]=n.useState(!1);n.useEffect(()=>{const x=setTimeout(()=>c(!0),s*80);return()=>clearTimeout(x)},[s]);const l=t.status==="ok"||t.status==="healthy"||t.status==="up",r=t.status==="warning"||t.status==="degraded",d=l?"bg-green-500":r?"bg-yellow-500":"bg-red-500",h=l?"shadow-green-500/50":r?"shadow-yellow-500/50":"shadow-red-500/50";return e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2.5 rounded-lg bg-slate-800/40 hover:bg-slate-800/70 transition-all duration-500 ${i?"opacity-100 translate-y-0":"opacity-0 translate-y-2"}`,children:[e.jsx("span",{className:`w-2.5 h-2.5 rounded-full ${d} shadow-md ${h} ${l?"animate-pulse":""}`}),e.jsx("span",{className:"text-xs text-slate-300 flex-1 truncate",children:t.name}),t.latency!=null&&e.jsxs("span",{className:"text-[10px] text-slate-600 font-mono",children:[t.latency,"ms"]})]})}function $({alert:t,index:s}){const[i,c]=n.useState(!1);n.useEffect(()=>{const d=setTimeout(()=>c(!0),s*100);return()=>clearTimeout(d)},[s]);const l=t.severity==="critical"||t.level==="critical",r=t.severity==="high"||t.level==="high";return e.jsxs("div",{className:`flex items-center gap-3 px-3 py-2 rounded bg-slate-800/50 hover:bg-slate-800 transition-all duration-500 ${i?"opacity-100 translate-x-0":"opacity-0 -translate-x-4"}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full flex-shrink-0 ${l?"bg-red-500 animate-pulse shadow-md shadow-red-500/50":r?"bg-orange-500":"bg-yellow-500"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm text-white truncate",children:t.title||t.message||"Alerte"}),e.jsx("div",{className:"text-[10px] text-slate-500",children:t.metric||t.type||""})]}),e.jsx("span",{className:"text-[10px] text-slate-600",children:t.severity||t.level})]})}function E({lastUpdate:t}){const[s,i]=n.useState(!0);n.useEffect(()=>{const l=setInterval(()=>i(r=>!r),1500);return()=>clearInterval(l)},[]);const c=t?`${Math.round((Date.now()-t.getTime())/1e3)}s`:"---";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`w-2 h-2 rounded-full bg-green-500 transition-all duration-500 ${s?"opacity-100 scale-100":"opacity-60 scale-75"}`}),e.jsx("div",{className:"absolute inset-0 w-2 h-2 rounded-full bg-green-500 animate-ping opacity-30"})]}),e.jsxs("span",{className:"text-[10px] text-slate-600 font-mono",children:["Live Â· ",c]})]})}function I(){return e.jsx("div",{className:"space-y-4",children:[1,2,3].map(t=>e.jsx("div",{className:"h-32 bg-slate-900 rounded-lg border border-slate-800 animate-pulse",style:{animationDelay:`${t*200}ms`}},t))})}export{T as default};
