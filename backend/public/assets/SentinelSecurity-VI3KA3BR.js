import{r as l,j as e}from"./index-_yXYEqcL.js";const N=()=>({Authorization:`Bearer ${localStorage.getItem("admin_token")}`});function w(t,i=800){const[s,n]=l.useState(0),r=l.useRef(0);return l.useEffect(()=>{const o=r.current,c=t-o;if(c===0)return;const d=Date.now(),x=setInterval(()=>{const p=Date.now()-d,b=Math.min(p/i,1),a=1-Math.pow(1-b,3);n(Math.round(o+c*a)),b>=1&&(clearInterval(x),r.current=t)},16);return()=>clearInterval(x)},[t,i]),s}function C(){const[t,i]=l.useState([]),[s,n]=l.useState(null),[r,o]=l.useState(!0),[c,d]=l.useState(null);if(l.useEffect(()=>{const a=async()=>{try{const[h,y]=await Promise.allSettled([fetch("/api/nexus/sentinel/security/logs",{headers:N()}),fetch("/api/nexus/sentinel/security/stats",{headers:N()})]);if(h.status==="fulfilled"&&h.value.ok){const f=await h.value.json(),u=f.data??f;i(Array.isArray(u)?u:u.events||u.logs||[])}if(y.status==="fulfilled"&&y.value.ok){const f=await y.value.json(),u=f.data??f,g=u.security||u.stats||u,j=u.rateLimit||{};n({total:g.total??0,bySeverity:g.bySeverity??{},byType:g.byType??{},blockedIps:j.blocked??g.blockedIps??0,rateLimited:j.totalTracked??g.rateLimited??0})}d(new Date)}catch{}finally{o(!1)}};a();const m=setInterval(a,2e4);return()=>clearInterval(m)},[]),r)return e.jsx("div",{className:"space-y-4",children:[1,2].map(a=>e.jsx("div",{className:"h-28 bg-slate-900 rounded-lg animate-pulse",style:{animationDelay:`${a*150}ms`}},a))});const x={critical:"bg-red-500",high:"bg-orange-500",medium:"bg-yellow-500",low:"bg-blue-500",CRITICAL:"bg-red-500",HIGH:"bg-orange-500",MEDIUM:"bg-yellow-500",LOW:"bg-blue-500"},p={critical:"text-red-400",high:"text-orange-400",medium:"text-yellow-400",low:"text-blue-400",CRITICAL:"text-red-400",HIGH:"text-orange-400",MEDIUM:"text-yellow-400",LOW:"text-blue-400"},b={rate_limit_exceeded:"Rate limit depasse",invalid_input:"Entree invalide",sql_injection_attempt:"Tentative injection SQL",xss_attempt:"Tentative XSS",path_traversal_attempt:"Tentative path traversal",csrf_failure:"Echec CSRF",auth_failure:"Echec authentification",auth_success:"Connexion reussie",suspicious_activity:"Activite suspecte",blocked_ip:"IP bloquee",permission_denied:"Permission refusee"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(v,{label:"Evenements total",value:s?.total??t.length,color:"blue",desc:"Depuis le debut du mois",icon:"ðŸ“Š",index:0}),e.jsx(v,{label:"Critiques",value:s?.bySeverity?.critical??s?.bySeverity?.CRITICAL??0,color:"red",desc:"Evenements haute severite",icon:"ðŸ”´",index:1}),e.jsx(v,{label:"IPs bloquees",value:s?.blockedIps??0,color:"orange",desc:"Auto-ban apres 10 violations",icon:"ðŸ›¡ï¸",index:2}),e.jsx(v,{label:"Rate limited",value:s?.rateLimited??0,color:"yellow",desc:"Requetes refusees",icon:"âš¡",index:3})]}),s?.byType&&Object.keys(s.byType).length>0&&e.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 p-4",children:[e.jsx("div",{className:"text-sm font-medium text-white mb-3",children:"Repartition par type"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:Object.entries(s.byType).sort((a,m)=>m[1]-a[1]).map(([a,m],h)=>e.jsx(S,{type:a,count:m,label:b[a]||a,index:h},a))})]}),e.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-slate-800 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:"Journal de securite"}),e.jsx("div",{className:"text-[10px] text-slate-600",children:"Derniers evenements detectes par le bouclier"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[10px] text-slate-500",children:[t.length," events"]}),e.jsx(T,{lastUpdate:c})]})]}),t.length===0?e.jsxs("div",{className:"p-6 text-center",children:[e.jsxs("div",{className:"text-green-400 text-sm flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),"Aucun evenement de securite"]}),e.jsx("div",{className:"text-[10px] text-slate-600 mt-1",children:"Le bouclier surveille intrusions, injections SQL, XSS, et brute-force"})]}):e.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:t.slice(0,50).map((a,m)=>e.jsx(I,{evt:a,index:m,sevText:p,sevColors:x,typeLabels:b},a.id||m))})]}),e.jsxs("div",{className:"bg-slate-800/30 rounded-lg border border-slate-700/50 p-3 flex items-start gap-2",children:[e.jsx("span",{className:"w-2 h-2 mt-1 bg-green-500 rounded-full animate-pulse flex-shrink-0"}),e.jsxs("div",{className:"text-[11px] text-slate-500",children:[e.jsx("strong",{className:"text-slate-400",children:"Bouclier actif :"})," Detection automatique des injections SQL, XSS, DDoS, et brute-force. Auto-ban apres 10 violations. Rate limit : 20 req/min, 200/heure, 1000/jour."]})]})]})}function v({label:t,value:i,color:s,desc:n,icon:r,index:o}){const c=w(i),[d,x]=l.useState(!1);l.useEffect(()=>{const a=setTimeout(()=>x(!0),o*100);return()=>clearTimeout(a)},[o]);const p={blue:"border-blue-800 bg-blue-950/30",red:"border-red-800 bg-red-950/30",orange:"border-orange-800 bg-orange-950/30",yellow:"border-yellow-800 bg-yellow-950/30"},b={blue:"text-blue-400",red:"text-red-400",orange:"text-orange-400",yellow:"text-yellow-400"};return e.jsxs("div",{className:`p-3 rounded-lg border ${p[s]} transition-all duration-500 ${d?"opacity-100 translate-y-0":"opacity-0 translate-y-3"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-slate-400",children:t}),e.jsx("span",{className:"text-sm",children:r})]}),e.jsx("div",{className:`text-lg font-bold font-mono ${b[s]}`,children:c}),e.jsx("div",{className:"text-[9px] text-slate-600 mt-0.5",children:n})]})}function S({type:t,count:i,label:s,index:n}){const r=w(i,600),[o,c]=l.useState(!1);return l.useEffect(()=>{const d=setTimeout(()=>c(!0),n*60);return()=>clearTimeout(d)},[n]),e.jsxs("div",{className:`flex items-center justify-between px-3 py-2 bg-slate-800/40 rounded hover:bg-slate-800/70 transition-all duration-500 ${o?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:[e.jsx("span",{className:"text-[11px] text-slate-400 truncate mr-2",children:s}),e.jsx("span",{className:"text-xs text-white font-mono",children:r})]})}function I({evt:t,index:i,sevText:s,sevColors:n,typeLabels:r}){const[o,c]=l.useState(!1);l.useEffect(()=>{const p=setTimeout(()=>c(!0),Math.min(i*40,500));return()=>clearTimeout(p)},[i]);const d=t.severity==="critical"||t.severity==="CRITICAL",x=n[t.severity]||"bg-slate-500";return e.jsxs("div",{className:`flex items-center gap-3 px-4 py-2.5 border-b border-slate-800/30 hover:bg-slate-800/30 transition-all duration-400 ${o?"opacity-100 translate-x-0":"opacity-0 -translate-x-3"}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full flex-shrink-0 ${x} ${d?"animate-pulse shadow-md shadow-red-500/50":""}`}),e.jsx("span",{className:"text-[11px] text-slate-500 font-mono w-20 flex-shrink-0",children:L(t.timestamp||t.created_at)}),e.jsx("span",{className:`text-[10px] font-medium w-16 flex-shrink-0 ${s[t.severity]||"text-slate-400"}`,children:t.severity}),e.jsx("span",{className:"text-[11px] text-slate-300 flex-1 truncate",children:r[t.event_type||t.type||""]||t.event_type||t.type}),e.jsx("span",{className:"text-[11px] text-slate-600 font-mono w-24 text-right truncate",children:t.ip_address||t.ip||"---"})]})}function T({lastUpdate:t}){const[i,s]=l.useState(!0);return l.useEffect(()=>{const n=setInterval(()=>s(r=>!r),1500);return()=>clearInterval(n)},[]),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full bg-green-500 transition-all duration-500 ${i?"opacity-100":"opacity-40"}`}),e.jsx("div",{className:"absolute inset-0 w-1.5 h-1.5 rounded-full bg-green-500 animate-ping opacity-20"})]}),e.jsx("span",{className:"text-[10px] text-slate-600 font-mono",children:"20s"})]})}function L(t){if(!t)return"---";try{return new Date(t).toLocaleString("fr-FR",{hour:"2-digit",minute:"2-digit",second:"2-digit",day:"2-digit",month:"2-digit"})}catch{return t}}export{C as default};
